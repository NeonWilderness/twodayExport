<!-- Client-side Twoday Blog Export on Steroids, (C) 2014-2021 NeonWilderness, https://neonwilderness.twoday.net, MIT license -->
<!-- mustache template for twoday stories -->
<script type="text/x-mustache-template" id="musStory">TITLE: {{&title}}
CATEGORY: {{&category}}
BASENAME: {{&basename}}
DATE: {{date}}
AUTHOR: {{author}}
URL: {{&url}}
STATUS: {{status}}
ALLOW COMMENTS: {{allowcomments}}
-----
BODY:
{{&body}}
-----
{{#comments}}{{>musComment}}{{/comments}}--------
</script>
<!-- mustache template for twoday comments and replies -->
<script type="text/x-mustache-template" id="musComment">{{type}}:
DATE: {{date}}
AUTHOR: {{author}}
URL: {{&url}}
{{&body}}
-----
</script>
<!-- css inline style information for blog export function and main export divs -->
<script type="text/html" id="mainExport">
<style>.actionButton{padding:8px 16px;color:#fff;border-radius:3px;border:none;opacity:.8;cursor:pointer}.actionButton:focus,.actionButton:hover{opacity:1;box-shadow:2px 2px 6px #222}#btnExport{position:fixed;top:50px;left:4px;background:#27ae60;width:38px;height:38px;text-align:center;border-radius:50%;margin-bottom:0;padding:0;z-index:8999}#btnExport:focus,#btnExport:hover{outline:0;border:none}#selOverlay{position:fixed;top:0;left:0;width:100%;height:100%;z-index:9000;background-color:rgba(0,0,0,.6)}#selScreen{width:600px;margin:20px auto;padding:15px;background:#fff;z-index:9001;color:#444}#selScreen button:focus,#selScreen button:hover{outline:0;border:none}#btnIntro,#btnVersion{float:right;font-size:13px;background:#444;border:none;padding:3px 6px;border-radius:10px;color:#fff;cursor:pointer;margin-bottom:0}#btnIntro:focus,#btnIntro:hover,#btnVersion:focus,#btnVersion:hover{color:#ffd055}#selIntro p{font-size:12px;margin-bottom:1em}#selMessage{background:#f04124;color:#fff;padding:10px;margin-bottom:12px;font-size:13px}#selMessage span{display:block}#selMessage i{margin-right:8px}#selHint{font-size:.85em;margin:10px 10px 3px 0;border-left:2px solid #f5f5f5;padding:3px 0 3px 10px;line-height:1.6}#selScreen h3{border-bottom:2px solid #ddd;padding-bottom:10px;font-size:18px}#selScreen h3 span{color:#27ae60;font-size:.95em}#selScreen fieldset{margin:12px 0 0;border:1px solid #ddd;padding:8px 15px 12px;width:100%}#selScreen fieldset table{width:95%;margin:0 auto}#selScreen fieldset .leftCol{width:40%}#selScreen fieldset .statCol{width:20%;text-align:center}#selScreen .btnContainer .actionButton{font-size:14px;margin-bottom:0}#selScreen thead .statCol{color:#777}#selScreen legend{padding:0 8px;font-size:.9em;color:#27ae60}#selScreen legend i{margin-right:8px}#selScreen input[type=text]{display:inline;margin:4px 10px 0;padding:2px 4px;font-family:Arial,Helvetica,sans-serif;font-size:13px}#selScreen input[type=checkbox],#selScreen input[type=radio]{margin-bottom:0}#selScreen label{display:inline}#selScreen label[for=radDateSpan]{margin-right:15px}#btnCancel,#btnInfosOnly,#radNumberMax,#radStatusOffline,#radStatusPublic{margin-left:20px}#txtFromDate,#txtToDate{width:90px;text-align:center}#txtNumberFrom,#txtNumberMax{width:40px;text-align:center}#txtNewBlogUrl{width:315px;margin:0 0 0 4px!important}#wpMediaUrl{font-size:11px}#btnInfosOnly{background:#008cba}#btnCancel{background:#f04124}#btnStartExport,.bgGreen{background:#27ae60!important}.bgYellow{background:#fac000!important}.bgRed{background:#f04124!important}.btnContainer{text-align:center;margin:10px 0 0}.btnContainer i{margin-right:6px}#btnFile,#btnOK{background:#fff;color:#777;cursor:pointer;border:none;border-radius:10px;text-decoration:none;padding:3px 10px}#btnFile{margin-right:10px}#btnFile:hover,#btnOK:hover{color:#444}.picker__select--month,.picker__select--year{padding:0 .5em!important;font-family:Arial,Helvetica,sans-serif;font-size:12px}.chosen-choices,.chosen-results{font-size:14px}a.tip{cursor:help;border-radius:50%;background-color:#eee;width:18px;display:inline-block;line-height:18px;text-align:center;padding:1px}#txtTimeouts{width:110px}#txtVideoWidth{width:48px}#progressBars{font-size:.8rem}.progress{height:1rem}</style>
<div id="selOverlay" style="display:none"><div id="selScreen"></div></div>
</script>
<!-- mustache blog export selection screen template -->
<script type="text/x-mustache-html" id="musSelectionScreen">
<h3>Folgende Beiträge sollen exportiert werden:<button id="btnIntro" class="onSelect"><i class="fa fa-question"></i> Info</button></h3>
<div id="selIntro" style="display:none">
<p>Hallo <b>{{user}}</b> &mdash; mit diesem Auswahlbildschirm wählen Sie die aus Ihrem Twoday-Blog <b>{{blog}}</b> zu exportierenden Beiträge aus. Sie können Ihre Beiträge nach zeitlichen Kriterien, nach Status (öffentlich/offline), nach Kategorie/n oder nach Anzahl selektieren. Falls Ihre Exportdatei zu groß wird, können Sie mit Hilfe der Zeiteingrenzung oder der Anzahlbegrenzung kleinere Exportpakete erstellen, die Sie separat weiter verarbeiten.</p>
<p><b>Wichtig:</b> Exportdateien können nicht unmittelbar in einen Wordpress-Blog eingespielt werden, sondern müssen über ein spezielles Plugin importiert werden, das z.B. die korrekte Twoday-Kommentarstruktur (Kommentar/Antworten) in Wordpress herstellt. <span style="color:#f04124;font-weight:700">Falls Sie in Ihrem Blog keine Plugins installieren können, aktivieren Sie unten das Auswahlkästchen "Für wordpress.com exportieren".</span> Weitere Details und Informationen finden Sie im zugehörigen <a target="_blank" href="https://neonwilderness.twoday.net/stories/blog-export-on-steroids/">Blogbeitrag</a>.</p>
<p><i class="fa fa-copyright"></i> 2014-2021 <a target="_blank" href="https://neonwilderness.twoday.net">NeonWilderness</a>, Version {{version}}, lizensiert unter <a target="_blank" href="https://opensource.org/licenses/MIT">MIT</a><button id="btnVersion"><i class="fa fa-star-o"></i> Versionscheck</button></p>
<fieldset><legend><i class="fa fa-cogs"></i>Einstellungen</legend>
<input type="checkbox" id="chkAutolink"><label for="chkAutolink">Twoday-Textlinks in klickbare HTML-Links wandeln</label><br>
<input type="checkbox" id="chkDelGuest" checked="checked"><label for="chkDelGuest">(Gast)-Kennung aus Benutzernamen entfernen</label><br>
<input type="checkbox" id="chkKeepImg" checked="checked"><label for="chkKeepImg">&lt;img&gt;-Befehl bei gelöschten Bildern behalten</label><br>
<input type="checkbox" id="chkReadCount"><label for="chkReadCount">Beitragslesezähler mit exportieren</label><br>
<input type="checkbox" id="chkWrdPress"><label for="chkWrdPress">Für wordpress.com exportieren (fortlaufende Kommentare)</label><a class="tip" title="Wordpress.com erlaubt für Free-User keine Installation eigener Plugins. Daher können Kommentare nur fortlaufend, d.h. ohne strukturelle Einrückungen (Twoday: Antwort auf Kommentar) eingespielt werden."><i class="fa fa-question"></i></a><br>
<input type="checkbox" id="chkDebug"><label for="chkDebug">Testphase: Debug-Nachrichten über Console ausgeben</label><br>
<div id="pGoogleDrive" style="display:none"><input type="checkbox" id="chkGoogleDrive"><label for="chkGoogleDrive">googledrive-Ressourcen auflösen (gdImages-Anwender)</label></div>
<label for="txtVideoWidth">Videobreite (Videoload-Anwender)<input type="text" id="txtVideoWidth" value="500">Pixel (0=keine iframe-Konvertierung)</label><br>
<label for="txtTimeouts">Timeout-Grenzen (in ms)<input type="text" id="txtTimeouts" placeholder="200/5/5">(keine Eingabe=Standard)<a class="tip" style="margin-left:1rem" title="Nur für erfahrene Benutzer: Wartezeiten zwischen Serverzugriffen für Stories/Body/Comment; einzugeben in der Form nnnn/nnnn/nnnn, wobei nnnn=Millisekundenzahl"><i class="fa fa-question"></i></a></label>
</fieldset>
</div>
<div id="selMessage" style="display:none"></div>
<div id="selOptions">
<fieldset><legend><i class="fa fa-calendar"></i>Zeitliche Eingrenzung</legend>
<input type="radio" name="selDate" value="all" id="radDateAll" checked="checked"><label for="radDateAll">Alle</label><br/>
<input type="radio" name="selDate" value="dates" id="radDateSpan"><label for="radDateSpan">Zeitspanne:</label>
<label for="txtFromDate">Von-Datum<input type="text" id="txtFromDate" class="datepicker"></label>
<label for="txtToDate">Bis-Datum<input type="text" id="txtToDate" class="datepicker"></label>
</fieldset>
<fieldset><legend><i class="fa fa-tag"></i>Status</legend>
<input type="radio" name="selStatus" value="main" id="radStatusAll" checked="checked"><label for="radStatusAll">Alle</label>
<input type="radio" name="selStatus" value="mystories" id="radStatusPublic"><label for="radStatusPublic">Nur Veröffentlichte</label>
<input type="radio" name="selStatus" value="offline" id="radStatusOffline"><label for="radStatusOffline">Nur Unveröffentlichte</label>
</fieldset>
<fieldset><legend><i class="fa fa-th-large"></i>Kategorie</legend>
<select data-placeholder="Bitte Kategorie/n auswählen..." multiple="multiple" style="width:100%" class="chooseCategory">
<option selected="selected">Alle</option>
<option>Unkategorisiert</option>
<option>Unveröffentlicht</option>
{{#categories}}<option>{{.}}</option>{{/categories}}
</select>
</fieldset>
<fieldset><legend><i class="fa fa-list-ol"></i>Anzahl</legend>
<input type="radio" name="selNumber" value="all" id="radNumberAll" checked="checked"><label for="radNumberAll">Alle</label>
<input type="radio" name="selNumber" value="max" id="radNumberMax"><label for="radNumberMax">Maximal<input type="text" id="txtNumberMax" value="10">Beiträge,&nbsp;</label> <label for="txtNumberFrom">Start ab Beitrag<input type="text" id="txtNumberFrom" value="1"></label>
</fieldset>
<fieldset><legend><i class="fa fa-image"></i>Bildadressen</legend>
<input type="checkbox" id="chkUrlChange"><label for="chkUrlChange" style="margin-right:0">Twoday-Bild-URLs ändern auf</label>
<input type="text" id="txtNewBlogUrl" placeholder="https://www.meinneuerblog.me/wp-content/uploads">
</fieldset>
<div class="btnContainer">
<button id="btnStartExport" class="actionButton">Export starten...</button>
<button id="btnInfosOnly" class="actionButton">Nur Infos (Probelauf)...</button>
<button id="btnCancel" class="actionButton">Abbrechen</button>
</div>
</div>
</script>
<!-- mustache blog export status template -->
<script type="text/x-mustache-html" id="musStatusScreen">
<h3>Export Blog <span>{{blog}}</span> in Bearbeitung...<button id="btnIntro" class="onStatus"><i class="fa fa-question"></i> Info</button></h3>
<div id="selIntro" style="display:none">
<p>Während des Exports angezeigte Fehler sind i.d.R. Timeout-Lesefehler, d.h. dass die ent&shy;sprechenden Beiträge nicht in der regulären Zeit erfolgreich gelesen werden konnten. Timeouts entstehen bei schlechtem Antwort&shy;zeit&shy;verhalten des Twoday-Servers bzw. der Helma-Datenbank.</p>
<p>Nach einem Lesefehler wird der Exportlauf abgebrochen, da sonst die Exportdatei unvollständig wäre. Bitte versuchen Sie es dann erneut zu anderen Zeiten.</p>
<p><i class="fa fa-copyright"></i> 2014-2021 <a target="_blank" href="https://neonwilderness.twoday.net">NeonWilderness</a>, lizensiert unter <a target="_blank" href="https://opensource.org/licenses/MIT">MIT</a></p>
</div>
<fieldset><legend><i class="fa fa-dashboard"></i>Exportfortschritt</legend>
<table>
<thead>
<tr>
<th class="leftCol"></th>
<th class="statCol">gelesen</th>
<th class="statCol">selektiert</th>
<th class="statCol">exportiert</th>
</tr>
</thead>
<tbody>
<tr>
<td class="leftCol">Beiträge (öffentlich)</td>
<td class="statCol" id="pubArtRead">0</td>
<td class="statCol" id="pubArtSelected">0</td>
<td class="statCol" id="pubArtWrite">0</td>
</tr>
<tr>
<td class="leftCol">Beiträge (offline)</td>
<td class="statCol" id="offArtRead">0</td>
<td class="statCol" id="offArtSelected">0</td>
<td class="statCol" id="offArtWrite">0</td>
</tr>
<tr>
<td class="leftCol">Beitragstexte</td>
<td class="statCol" id="styRead">0</td>
<td class="statCol"></td>
<td class="statCol" id="styWrite">0</td>
</tr>
<tr>
<td class="leftCol">Kommentare</td>
<td class="statCol" id="comRead">0</td>
<td class="statCol"></td>
<td class="statCol" id="comWrite">0</td>
</tr>
<tr>
<td class="leftCol">Antworten auf Kommentare</td>
<td class="statCol" id="repRead">0</td>
<td class="statCol"></td>
<td class="statCol" id="repWrite">0</td>
</tr>
</tbody>
</table>
</fieldset>
<fieldset>
<div id="progressBars">
<div class="row">
<div class="small-3 columns">Übersichtsdaten</div>
<div class="small-9 columns"><div class="progress"><span id="mMain" class="meter" style="width:1%"></span></div></div>
</div>
<div class="row">
<div class="small-3 columns">Beiträge</div>
<div class="small-9 columns"><div class="progress"><span id="mStories" class="meter" style="width:1%"></span></div></div>
</div>
<div class="row">
<div class="small-3 columns">Kommentare</div>
<div class="small-9 columns"><div class="progress" style="margin-bottom:0"><span id="mComments" class="meter" style="width:1%"></span></div></div>
</div>
</div>
</fieldset>
<div id="selMessage" class="{{msgColor}}" style="display:none;margin-bottom:0"><span></span><span id="selHint" style="display:none">Klicken Sie auf "Datei...", um die aufbereiteten Blogdaten dauerhaft in die Exportdatei <b>"{{filenameExport}}"</b> zu speichern. Die Übersichtsliste statischer Twoday-Bilder wird in Datei <b>"{{filenameResourceList}}"</b> bereitgestellt.</span><span class="btnContainer"><a id="btnFile" href="#" target="_blank" title="Blogdaten speichern" style="display:none"><i class="fa fa-fw fa-download"></i>Datei...</a><a id="btnOK" href="#" title="Fenster schließen"><i class="fa fa-fw fa-check"></i>OK</a></span></div>
</script>
<!-- mustache template for list of static twoday images and url changes -->
<script type="text/x-mustache-html" id="musResourceList"><!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Statische Twoday-Bildadressen</title>
<style>body{background:#fff;color:#444;padding:10px 20px;font-family:Tahoma,sans-serif}#wrapper{width:800px;margin:0 auto}h3 span{color:#27ae60;font-weight:400;font-size:.9em}.hint{font-size:.8em;background-color:#f5f5f5;border-top:2px solid #666;border-bottom:2px solid #666;padding:10px}</style>
</head>
<body>
<div id="wrapper">
<h3>Liste der gefundenen Twoday-Ressourcen für <span>{{&blog}}</span></h3>
<p class="hint">
Die nachstehende Auflistung enthält alle Ressourcen der während des Exportlaufs selektierten Beiträge, die ein auf Twoday gespeichertes Bild (Bildadresse beginnt mit "{{&staticImgUrl}}") oder eine Datei (Dateiadresse beginnt mit "{{&staticFileUrl}}") verwenden. {{#urlChange}}Gemäß Ihrer Anforderung wurden alle diese Adressen in der Exportdatei auf das neue Blog-Medienverzeichnis "{{wpMediaUrl}}" geändert.{{/urlChange}}
</p>
{{#storyResources}}{{&.}}{{/storyResources}}
</div>
</body>
</html>
</script>
<style>#msgButton{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAAEEfUpiAAAACXBIWXMAAFxGAABcRgEUlENBAAAACXRFWHRDb21tZW50AACJKo0GAAAEcklEQVR4nI1XTUxUVxQeCIkGlkBcwKKbbkiEjO1CdIGrBmqNsc5CDG6aYUNDHMIkRhfuSNwMie0CTNMOGd1QRCNGE40NxkXTJo2pojFuABPxB5VgYDTNDHN6v+G78867770ZXnKY9+499zvfPff8XGIiEoMkk8k0fssfLRclc/EfkfKAmRk1A+UHvzG7hIMxu77FTuDjAWYh5n17NJ4VKYkHKkpjOaZ4LIoyAkW7otla1XSIUO+j9ePdgEK3D9JIJ9/PGVmq7EMpnTRySI/ZiU3YU4oDRhKW5FnL4cQNn/0Gq7BiBjYw+O9bT8HIbjNXgMIQBorGVU/fi7T+JPLFRFlhvOxKem7S+uDlRsUfmLuPP43kUFDwKTM+oXcRN7LgujngB+UkoSwYuWNkjd/r1mIAwEzkjZwnnQ4jJUUJMke9OoLFNUXhwja96OEb/9lS8lyTNZLCS7+RMR0xVh6vhgJA0tYw/vQYyWmAUze3F374LJXnTd4H0FsB4MtHI10uizP3RRbXA9YHuWbLSKt2YoLOaSJQu5FfjNwyMqz0po2UIo+RSgiEojpOyLxO36oABDmEesEcCSwMBUCQMFiEwXOHwWRZnIsEUD4YiGBUj8qB5AzL2DgX19GBc47nEZUd1D2PqHUBKhmsF06Z9Pnykg8oQ/0HthJYj2e5OK8B8By7FoiDNh3+eClgf2ZilxuyeI5cDQBsEGAFRVMnUjoM4NuZYC4QYAx5pAEymOyf88IXzzfTIhf+EvlzJQAwhO6hAXqtQmFLZI2J9Hpz+/fA5QBADolYLmyo4e4JlLxElK+nfFuYdJ3YiswiwKDrg87fQvffhQzWcbBsqygqakgBgRRUVIqtjTpUS0hV+40UZiojpdup08TFiahkWgpLGrQ1lVTxqumM1GXu61qA2pCqmc5RQtAUgd1C4xqap25kDdkRAWb4kgKHC9C0Oqus6aSOrkFLrttquTDBAxXW3yY9z1o9rOq1Pehhe9gKq4kYQsxEJAFW02UqTzhGU07zryXQTTlkJoi9nFTt3U42s5SjVXUpw4NRRv5+5WXq99erkhlUJLpoA7aaNQEbtd3K+GS1XT586xE4OlvTI5OKRDdtzdtS0sOBnDLeV8vNj1Y9At+FlNwQ6VMkcrRZLoaj/BhSBMZdgMMz/vb05J1HoPd3b/zgFZE9P4cSGFcEhmhz1F6u8DGmCPiay3Fzxv8Vt42hvMPIs/ceAXSt2efe9+onka+mAgTSisAYbfbbACyyxdWTANrjhruLH26LbOk+4Twgtz8Xuntg7aLxetoqllsqB0fIKKu8gLtqPgRMRv7wG35hGsu+bOTZA6NN7T5LWyOVLOCEvZrjytGgiGSiAuv0PZG9v1YNvIzCbyC2r9mEld88lXCBqlNEcO3Hhcu9+mspUadDYdYRS4hdvZuJV443uQjXwYGk+l+tlvCcB7hWiBUow5EEFFAjj8ZeeK2sJb3/oOwFeM3RWefaxmo2drQjhxRaM67uuLank94VHmM7asFa/gdN40X5ePFv7gAAAABJRU5ErkJggg==) no-repeat #ccc 1em center;padding:16px 16px 17px 4em;opacity:1;border-radius:0;box-shadow:none;margin-left:15px}#msgButton:hover{background-color:#666}</style>
<div id="exportLoginStatus" style="display:none"><% site.loginstatus %></div>
<script type="text/javascript">!function(){"use strict";var D={isUserAdministrator:function(){var e=document.getElementById("exportLoginStatus"),t=(e.textContent||e.innerText).match(/\((.*)\)/);return!!t&&"Administrator"===t[1]},isFontAwesomePresent:function(){var e=!1;return $.each(document.styleSheets,function(){return!(e=0<=(this.href||"").indexOf("font-awesome.min.css"))}),e},musSelectionScreen:{alias:"<% site.alias %>",blog:"<% site.href %>",siteId:"<% site.id %>",user:"<% username %>",version:"1.7",categories:[]},musStatusScreen:{pubArtRead:0,pubArtSelected:0,pubArtWrite:0,offArtRead:0,offArtSelected:0,offArtWrite:0,styRead:0,styWrite:0,comRead:0,comWrite:0,repRead:0,repWrite:0,filenameExport:"<% site.alias %> export.txt",filenameResourceList:"<% site.alias %> url liste.html",init:function(e){this.pubArtRead=0,this.pubArtSelected=0,this.pubArtWrite=0,this.offArtRead=0,this.offArtSelected=0,this.offArtWrite=0,this.styRead=0,this.styWrite=0,this.comRead=0,this.comWrite=0,this.repRead=0,this.repWrite=0,this.startTime=(new Date).getTime(),this.isTestRun=e},incValue:function(e,t){var s=void 0===t?1:t;this[e]+=s;var r=document.getElementById(e);r?r.innerText=this[e]:console.log("ID "+e+" not found!")},startTime:null,timeUsed:function(){var e=Math.floor(((new Date).getTime()-this.startTime)/1e3),t=Math.floor(e/3600),s=Math.floor((e-3600*t)/60),r=e-3600*t-60*s;return t<10&&(t="0"+t),s<10&&(s="0"+s),r<10&&(r="0"+r),t+":"+s+":"+r}},musStory:"",musPartials:{},filelen:0,stories:[],blobList:[],resourceList:[],xrefs:{},timeoutStories:500,timeoutBody:5,timeoutComments:5,autoLinker:null,getPicker:function(e){var t=$(e).pickadate().pickadate("picker").get("select");return null===t?0:t.pick},validateSelectionParams:function(e){var t="";return e.properDates()?e.validDates()?e.validCategoryNum()?e.validCategoryMix()?e.validMaxNumber()?e.validFromNumber()?e.validBlogUrl()||(t="validBlogUrl"):t="validFromNumber":t="validMaxNumber":t="validCatMix":t="validCatNum":t="validDates":t="properDates",0<t.length?($("#selMessage").html({properDates:"Bitte geben Sie bei gewählter Zeiteingrenzung ein gültiges Von- und Bis-Datum ein!",validDates:"Das Bis-Datum muss größer als das Von-Datum sein!",validCatNum:"Bitte wählen Sie mindestens eine Kategorie aus (z.B. 'Alle')!",validCatMix:"Entfernen Sie die 'Alle'-Kategorie, wenn Sie einzelne Kategorien selektieren wollen!",validMaxNumber:"Bitte geben Sie bei gewählter Anzahlbegrenzung eine gültige <b>Beitragsanzahl</b> ein!",validFromNumber:"Bitte geben Sie bei gewählter Anzahlbegrenzung eine gültige <b>Startnummer</b> ein!",validBlogUrl:"Zur Adressanpassung der Twoday-Bilder bitte eine gültige neue Blogadresse eingeben!"}[t]).show(),!1):($("#selMessage").html("").hide(),!0)},renderScreen:function(e){var t=Mustache.render($("#"+e).html(),this[e]);$("#selScreen").html(t),$("#btnIntro").on("click",function(e){e.preventDefault();var t=$(this);t.hasClass("onSelect")&&($("#selMessage").html("").attr("class","").hide(),$("#selOptions").toggle(0)),$("#selIntro").toggle(0),t.find("i").toggleClass("fa-question fa-times")})},filterStory:function(e){var t,s=!1;return this.params.selDate&&(s=(t=Date.parse(e.date))<this.params.fromDate||t>this.params.toDate),s||"mystories"!==this.params.selStatus||(s="draft"===e.status),s||(s=!this.params.isSelectedCategory(e.category)),s},closeOverlay:function(){$(document).off("keyup"),$("#selOverlay").hide(400)},renderMessage:function(e,t){$("#selMessage>span:first").text(e).parent().addClass(t).show(400),$("#btnOK").on("click",function(e){e.preventDefault(),D.closeOverlay()})},renderWarning:function(){this.renderMessage("Für die gewählten Filterkriterien wurden keine Beiträge gefunden!","bgYellow")},renderError:function(e){this.renderMessage(e,"")},recursiveStories:function(l,c){var u="/stories/"+this.params.selStatus+"?page="+l,e=$.get(u,function(e){var t,s,r,n,i=$(e).find(".admin");D.params.debugMode&&console.log("Read story overview page: ",u),i.find(".listItem").each(function(){var e=$(this),t=e.find(".leftCol"),s={};s.title=$.trim(e.find("tr>td>b").text()),r=t.text(),s.id=r.match(/id="(.*)"/)[1],n=r.match(/Status: (.*)\s/)[1].split(",")[0].split(" in "),s.status="online"===n[0]?"publish":"draft",r=t.find("a[href*=topics]").eq(0).text(),s.category=0<r.length?r:"publish"===s.status?"Unkategorisiert":"Unveröffentlicht",r=t.find(">span").eq(2),n=r.text(),s.author=n.match(/erstellt von (.*) am/)[1],D.params.delGuest&&(s.author=s.author.replace(" (Gast)","")),n=n.match(/ am (.*)/)[1],s.date=n.substr(6,4)+"-"+n.substr(3,2)+"-"+n.substr(0,2)+n.substr(10),n=r.find(">a"),s.url=0<n.length?n.attr("href"):"",D.musStatusScreen.incValue("publish"===s.status?"pubArtRead":"offArtRead"),D.filterStory(s)||c.push(s)});var a=i.find(".pageNavSummary:first");if(t=0===a.length?0:(s=parseInt(a.text().split(" ")[3],10),Math.floor(s/20)),l<t)document.getElementById("mMain").style.width=20*(l+1)/s*100+"%",setTimeout(function(){return D.recursiveStories(l+1,c)},D.timeoutStories);else{if(0<c.length){document.getElementById("mMain").style.width="100%",c.sort(function(e,t){return Date.parse(t.date)-Date.parse(e.date)});var o=c[c.length-1].id;return D.params.oldestIDLen=o.length,D.params.oldestIDVal=parseInt(o),D.params.selNumber&&(D.stories=c.slice(D.params.sliceFrom(),D.params.sliceTo())),D.recursiveBody(0,D.stories)}D.renderWarning()}}).fail(function(){D.params.debugMode&&console.log(">>>Fail to read storyPage: ",u,e.status,e.statusText),D.renderError("Fehler beim Lesen der Beitragsübersichtsseite: "+u+", status: "+e.status+", text: "+e.statusText)})},convertNiceUrlToStoryID:function(t,s){try{if(!("storyID"in s))return void console.log(">>> Missing storyID field in: "+t+" - xref-Object: "+JSON.stringify(s));if(s.storyID&&0<s.storyID.length)for(var e,r=D.params.siteStoriesHref+"/",n=new RegExp(r+t,"gi"),i=r+s.storyID,a=0,o=s.refIdx,l=o.length;a<l;++a)(e=D.stories[o[a]]).body=e.body.replace(n,i);D.params.debugMode&&console.log("convertNiceUrlToStoryID: slug="+t+", storyID="+s.storyID+", #stories="+s.refIdx.length)}catch(e){console.log(">>>Error: "+e+", slug: "+t+", xref:",s)}},addMissingNiceUrlStoryIDs:function(s,r){var n=r[s],i=D.xrefs[n];if(0<i.storyID.length)return D.convertNiceUrlToStoryID(n,i),(s+=1)<r.length?D.addMissingNiceUrlStoryIDs(s,r):D.renderStories();var e="/stories/"+n,t=$.get(e,function(e){var t=$(e).find(".story");if(i.storyID=t.attr("data-storyid"),D.convertNiceUrlToStoryID(n,i),!((s+=1)<r.length))return D.renderStories();setTimeout(function(){return D.addMissingNiceUrlStoryIDs(s,r)},D.timeoutBody)}).fail(function(){if(D.params.debugMode&&console.log(">>>Fail to read source story: ",e,t.status,t.statusText),!((s+=1)<r.length))return D.renderStories();setTimeout(function(){return D.addMissingNiceUrlStoryIDs(s,r)},D.timeoutBody)})},assignNiceUrlsStoryID:function(){var r=this.xrefs,e=Object.keys(r).length;if(0!==e){var n=0;$.each(this.stories,function(e,t){var s=t.basename.substr(0,t.basename.lastIndexOf("-"));void 0!==r[s]&&(r[s].storyID=t.id,n++)}),D.params.debugMode&&console.log("End of assignNiceUrlsStoryID: #xrefs=",e,"#IDs found=",n)}},isNiceUrl:function(e){return 0!==e.length&&(!$.isNumeric(e)||e.length<D.params.oldestIDLen&&parseInt(e)<D.params.oldestIDVal)},saveNiceUrlXrefs:function(e,t){var s,r,n,i,a;$("<div>").html(e.body).find('a[href*="'+D.params.siteStoriesHref+'"]').each(function(){if(null===(s=this.href.match(/\/stories\/(.*)\/?/)))return!0;if(r=(r=(r=s[1].split("#")[0]).split("?")[0]).split("/")[0],D.isNiceUrl(r))if(void 0===D.xrefs[r])D.xrefs[r]={storyID:"",refIdx:[t]},D.params.debugMode&&console.log("Init xref: "+r+" in basename: "+e.basename);else{for(n=0,a=D.xrefs[r],i=a.refIdx.length;n<i&&a.refIdx[n]!==t;++n);i<=n&&D.xrefs[r].refIdx.push(t)}})},legitSlugChars:function(e){return e.toLowerCase().replace(/ä/g,"ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/ß/g,"ss").replace(/[^\w ]+/g,"").trim().replace(/ +/g,"-")},transformGDRefs:function(e){if(e.indexOf("googledrive")<0)return e;var t,s=$("<div>").html(e);return t="50425"==D.musSelectionScreen.siteId?{gdDomain:"https://static.twoday.net",gdRootFolder:"/doktorp",gdSubFolder:"images",addClass:"transformed",titleContent:"keep"}:{gdDomain:"https://neonwilderness.de",gdRootFolder:"/public",gdSubFolder:"images",addClass:"neonimg th",titleContent:"keep"},s.find(".googledrive").gdimages().init(t),s.html()},transformVideoloadRefs:function(e){if(e.indexOf("html5video")<0)return e;var n=$("#workDiv"),t=$("<div>").html(e),s=t.find(".html5video");return s.each(function(e,t){var s=t.className.match(/width-[0-9]+/),r="width-"+D.params.videowidth;s?t.className=t.className.replace(s[0],r):t.className+=" "+r,n.append($(t).clone())}),window.video2day.run({exportRun:!0}),n.find(".html5video").each(function(e,t){s.eq(e).html(t.dataset.content)}),n.empty(),t.html()},staticURL:"https://static.twoday.net",sanitizeLinks:function(e){return e=(e=(e=(e=(e=e.replace(/((http|https):\/\/)?static\.twoday\.net/gi,this.staticURL)).replace(/((http|https):\/\/)?twoday\.net\/static/gi,this.staticURL)).replace(new RegExp('//+"'),"/")).replace(new RegExp("\\n-{8}\\n","g"),"\n|--------\n")).replace(new RegExp("\\n-{5}\\n","g"),"\n|-----\n"),53472===this.params.siteId&&(e='<div style="width:500px">'+e+"</div>"),e},recursiveBody:function(r,n){var i=n[r],a="/stories/"+i.id+"/edit";this.musStatusScreen.incValue("publish"===i.status?"pubArtSelected":"offArtSelected");var e=$.get(a,function(e){var t=$(e).find(".admin"),s=t.find("#modNiceUrlsText").text();if(i.body=t.find(".formText").text(),D.params.debugMode&&console.log("Read source of story: ",a),i.body=D.sanitizeLinks(i.body),D.params.googleDrive&&(i.body=D.transformGDRefs(i.body)),0<D.params.videowidth&&(i.body=D.transformVideoloadRefs(i.body)),0===s.length&&0===(s=D.legitSlugChars(i.title)).length&&(s="notitle"),i.basename=s+"-"+i.id,i.allowcomments=Math.abs(!t.find("#discussions").prop("checked")-1).toString(),D.musStatusScreen.incValue("styRead"),!((r+=1)<n.length))return document.getElementById("mStories").style.width="100%",D.recursiveComments(0,n);document.getElementById("mStories").style.width=r/n.length*100+"%",setTimeout(function(){return D.recursiveBody(r,n)},D.timeoutBody)}).fail(function(){D.params.debugMode&&console.log(">>>Fail to read source story: ",a,e.status,e.statusText),D.renderError("Fehler beim Lesen des Beitrags: "+a+", status: "+e.status+", text: "+e.statusText)})},selectorsStandard:{set:"Standard",comments:".comments",commentDate:">.commentDate|text",commentAuthor:">.commentDate>a|text",commentUrl:">.commentDate>a|href",commentTitle:">h4|text",commentBody:">div:nth-child(3)|html",reply:">.reply",d2:function(e){return(""+e).length<2?"0"+e:""+e},months:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],getMonth:function(e){return $.inArray(e,this.months)+1},extractDate:function(e,t){var s=e.split(" - ")[1],r=s.match(/(.*)\./)[1],n=this.getMonth(s.match(/\s(.*)\,/)[1]),i=t.substr(0,4),a=s.match(/\, (.*)/)[1];return s=i+"-"+this.d2(n)+"-"+this.d2(r)+" "+a,Date.parse(s)<Date.parse(t)?(parseInt(i,10)+1).toString()+s.substr(4):s},anonymousAuthor:function(e){return e.find(">.commentDate").text().split(" - ")[0]}},selectorsLayout:{set:"Layout",comments:".comments",commentDate:">.commentDate|text",commentAuthor:">.commentDate>a|text",commentUrl:">.commentDate>a|href",commentTitle:">h4|text",commentBody:">div:nth-child(3)|html",reply:">.reply",extractDate:function(e){return e.split(" - ").pop()},anonymousAuthor:function(e){return e.find(">.commentDate").text().split(" - ")[0]}},selectorsFoundation:{set:"Foundation",comments:".comments",commentDate:".commentDate:first>span|title",commentAuthor:".commentUser:first>a|text",commentUrl:".commentUser:first>a|href",commentTitle:".commentTitle:first|text",commentBody:".commentText:first|html",reply:">.reply",extractDate:function(e){return e.substr(0,16)},anonymousAuthor:function(e){return e.find(".commentUser:first").text().match(/(.*)\s/)[1]}},commentSelectors:{sets:[{id:"Layout",checkfor:"#exportLayout"},{id:"Foundation",checkfor:"#f5Body"},{id:"Standard",checkfor:""}],initSet:function(){$.each(this.sets,function(){if(0===this.checkfor.length||0<$(this.checkfor).length)return $.extend(D.commentSelectors,D["selectors"+this.id]),!1})},retrieveDOMValue:function(e,t){var s=this[t].split("|"),r=e.find(s[0]).eq(0);if(!(0<r.length))return"";switch(s[1]){case"text":return r.text();case"html":return r.html();default:return r.attr(s[1])}}},recursiveComments:function(a,o){var l=o[a],c="/stories/"+l.id,u=this.commentSelectors,d=this.params;function r(e){if(!e.length)return"";if(0<=e.indexOf("/")){var t=e.split("/");if("<% site.alias %>"!==t[0])return"";e=t[1]}for(var s,r=0,n=l.images.length;r<n;++r)if(e===(s=l.images[r]).split(".")[0])return s;return d.keepImg?(e+=".jpg",l.images.push(e),"|"+e):""}function n(e){var t=e.name||"";if(t&&l.files.hasOwnProperty(t)){var s=l.files[t];return s.name=t,Mustache.render('<a target="_blank" href="{{&url}}">{{&name}} ({{&ext}})</a>',s)}return""}function i(s){var e=function(e,t){s[e]&&(s[e]=" "+e+"="+(t?'"'+s[e]+'"':s.prop))};if(!s.fullName){var t=r(s.name||"");if(0===t.length)return"";"|"===t.charAt(0)&&(t=t.substr(1),s.class?s.class+=" notFound":s.class="notFound"),s.fullName=d.staticImgUrl+t}return e("align",!0),e("border",!0),e("class",!0),e("height",!0),s.href&&(s.linkto=s.href),e("target",!0),53472===d.siteId&&(s.width=1<l.images.length?"248":"500"),e("width",!0),Mustache.render('{{#linkto}}<a{{&target}} href="{{&linkto}}">{{/linkto}}<img src="{{&fullName}}" alt="{{&name}}"{{&class}}{{&align}}{{&width}}{{&height}}{{&border}}>{{#linkto}}</a>{{/linkto}}',s)}function m(e){return e.to=e.to||"",e.text=e.text||e.to,e.target&&(e.target=' target="'+e.target+'"'),Mustache.render('<a{{#target}}{{&target}}{{/target}} href="{{&to}}">{{&text}}</a>',e)}function h(e,t,s){var r=s.find("table.gallery").eq(t).css("width","100%").addClass("regenerated");return r.find("a").each(function(){this.innerHTML=i({fullName:this.href,width:"100%"})}),r[0].outerHTML}function f(e){if(e.indexOf('"gallery')<0)return e;var t=$("<div>").html(e);return t.find("table.gallery").not(".regenerated").each(function(e,t){$(t).css("width","100%").addClass("manual").find("a").each(function(){var e=this.href.split("/").pop().split(".")[0],t=d.staticImgUrl+r(e);this.outerHTML=i({href:t,fullName:t,width:"100%"})})}),t.html()}function p(e,t,s){e.id=e.id.split("/").reverse()[0];var r=s.find("#twodayPoll-"+e.id);return r.length?r[0].outerHTML:""}function g(e){return m({to:"<% site.href %>stories/"+l.id,text:e.text||"Link zum Beitrag"})}function y(e){return"<% site.href %>stories/"+l.id}function b(t,e){var s=new RegExp(e?" ":" ","g"),r=e?" ":" ",n=t.match(/(".*?")/g);return n&&n.map(function(e){t=t.replace(e,e.replace(s,r))}),t}function v(r,n,e,i){var t=new RegExp("<\\%\\s*"+e+"\\s.*?\\s*%>","gi"),s=r.match(t);return s&&s.map(function(e,t){var s=b(e.substr(2,e.length-4).trim(),!0).split(" ").reduce(function(e,t){var s=t.indexOf("=");if(0<=s){var r=t.substr(0,s),n=t.substr(s+1);e[r]=b(n,!1).replace(/^["'](.+)["']$/,"$1")}return e},{});r=r.replace(e,i(s,t,n))}),r}function x(e){return d.urlChange?e.replace(d.regStaticImg,d.wpMediaUrl):e}function S(t,s){var e;return[{tag:"file",cb:n},{tag:"gallery",cb:h},{tag:"image",cb:i},{tag:"link",cb:m},{tag:"poll",cb:p},{tag:"story\\.link",cb:g},{tag:"story\\.url",cb:y}].map(function(e){t=v(t,s,e.tag,e.cb)}),t=x(t=f(t)),e=t,d.urlChange?e.replace(d.regStaticFile,d.wpMediaUrl):e}function w(e,t,s){var r={},n=u.retrieveDOMValue(e,"commentTitle"),i=u.retrieveDOMValue(e,"commentBody"),a=u.retrieveDOMValue(e,"commentDate");return r.date=u.extractDate(a,l.date),r.type=t,r.author=u.retrieveDOMValue(e,"commentAuthor"),0===r.author.length&&(r.author=u.anonymousAuthor(e)),d.delGuest&&(r.author=r.author.replace(" (Gast)","")),r.url=u.retrieveDOMValue(e,"commentUrl"),r.body=f(0<n.length?n+" "+i:i),r.body=x(r.body),0<d.videowidth&&(r.body=D.transformVideoloadRefs(r.body)),D.musStatusScreen.incValue("C"===s?"comRead":"repRead"),r}var e=$.get(c,function(e){var t,s,r=$(e).find("#content");D.params.debugMode&&console.log("Read rendered story: ",c),l.images=[],r.find("img").each(function(){(t=this.src||"").match(d.regStaticImg)&&(s=t.substr(t.lastIndexOf("/")+1),53472!==d.siteId&&(s=s.replace("_small.",".")),l.images.indexOf(s)<0&&l.images.push(s))}),l.files={},r.find(".fileMacro").each(function(){l.files[this.dataset.name]={url:this.dataset.url,ext:this.dataset.ext}}),l.body=S(l.body,r),D.params.autoLink&&(l.body=D.autoLinker.link(l.body)),D.saveNiceUrlXrefs(l,a),D.params.readCount&&(l.body+="\n[#"+(r.find(".story").attr("data-reads")||"0")+"]"),l.comments=[];var n=r.find(u.comments);if(l.cntComments=n.length,l.cntReplies=0,n.each(function(){var e,t=$(this);if(!(0<=(e=t).text().indexOf("/modTrackback")||0<e.find('a[name="trackbacks"]').length)){l.comments.push(w(t,"COMMENT","C"));var s=t.find(u.reply);l.cntReplies+=s.length,s.each(function(){var e=$(this);l.comments.push(w(e,d.typeReply,"R"))})}}),!((a+=1)<o.length)){document.getElementById("mComments").style.width="100%",D.params.debugMode&&console.log(">>> xrefs:",JSON.stringify(D.xrefs,null,2)),D.assignNiceUrlsStoryID();var i=Object.keys(D.xrefs);return 0<i.length?D.addMissingNiceUrlStoryIDs(0,i):D.renderStories()}document.getElementById("mComments").style.width=a/o.length*100+"%",setTimeout(function(){return D.recursiveComments(a,o)},D.timeoutComments)}).fail(function(){D.params.debugMode&&console.log(">>>Fail to read rendered story: ",c,e.status,e.statusText),D.renderError("Fehler beim Lesen der Beitrags: "+c+", status: "+e.status+", text: "+e.statusText)})},renderStory:function(e){var t=Object.assign({},e,{url:e.url||this.musSelectionScreen.blog}),s=Mustache.render(this.musStory,t,this.musPartials);return this.filelen+=s.length,D.params.debugMode&&console.log("Render export for story: ",e.basename,"FileLen: ",this.filelen),s},mergeImageAndFileResources:function(t){var s,r=[];return t.images.map(function(e){r.push({isImage:!0,name:e,source:this.params.staticImgUrl+e})},this),Object.keys(t.files).map(function(e){s=t.files[e],r.push({isImage:!1,name:e+"."+s.ext,source:s.url})}),r},renderResourceList:function(e){var t={id:e.id,title:e.title,date:e.date,resources:this.mergeImageAndFileResources(e)},s={resource:'<li><a class="resource {{#isImage}}image{{/isImage}}{{^isImage}}file{{/isImage}}" target="_blank" href="{{&source}}">{{name}}</a>{{^isImage}} (Datei){{/isImage}}'+(this.params.urlChange?" geändert in "+this.params.wpMediaUrl+"{{name}}":"")+"</li>"},r=Mustache.render('<p><div>Beitrag: <a target="_blank" href="<% site.href %>stories/{{id}}">{{title}}</a> vom {{date}}:</div><ol>{{#resources}}{{>resource}}{{/resources}}</ol></p>',t,s);this.resourceList.push(r)},renderStories:function(){var e,t=this.blobList,s=this.musStatusScreen,r=!s.isTestRun;$.each(this.stories,function(){e=D.renderStory(this),r&&(t.push(e),s.incValue("publish"===this.status?"pubArtWrite":"offArtWrite"),s.incValue("styWrite"),s.incValue("comWrite",this.cntComments),s.incValue("repWrite",this.cntReplies)),(this.images.length||this.files.length)&&D.renderResourceList(this)}),this.renderInfoMessage()},writeExportFile:function(){var e=new Blob([this.blobList.join("")],{type:"text/plain;charset=utf-8"});window.saveAs(e,this.musStatusScreen.filenameExport);var t,s,r=$("#musResourceList").html(),n=$.extend({},this.musSelectionScreen,{storyResources:this.resourceList},this.params);0===this.resourceList.length&&this.resourceList.push("<p>*** Keine statischen Twoday-Bildadressen gefunden. ***</p>"),t=Mustache.render(r,n),s=new Blob([t],{type:"text/html;charset=utf-8"}),window.saveAs(s,this.musStatusScreen.filenameResourceList)},renderInfoMessage:function(){var e=Mustache.render("Export{{#isTestRun}}testlauf{{/isTestRun}} ohne Fehler beendet nach {{timeUsed}} (hh:mm:ss), "+Math.round(this.filelen/1024)+" KB",this.musStatusScreen);$("#selMessage>span:first").html(e).parent().addClass("bgGreen").show(400),D.params.debugMode&&console.log("--------------- End of blog export process ---------------"),this.musStatusScreen.isTestRun||yepnope([{test:void 0===window.saveAs,yep:["https://static.twoday.net/cdn/files/filesaver-min-js.js"],complete:function(){$("#selHint, #btnFile").show(),$("#btnFile").on("click",function(e){e.preventDefault(),D.writeExportFile()})}}]),$("#btnOK").on("click",function(e){e.preventDefault(),D.closeOverlay(),D.stories.length=0,D.blobList.length=0})},exportArticlesAndComments:function(e){this.musStatusScreen.init(e);var t={autoLink:$("#chkAutolink").prop("checked"),delGuest:$("#chkDelGuest").prop("checked"),keepImg:$("#chkKeepImg").prop("checked"),readCount:$("#chkReadCount").prop("checked"),typeReply:$("#chkWrdPress").prop("checked")?"COMMENT":"REPLY",debugMode:$("#chkDebug").prop("checked"),googleDrive:$("#chkGoogleDrive").prop("checked"),videowidth:parseInt($("#txtVideoWidth").val()),timeouts:$("#txtTimeouts").val(),selDate:"dates"===$("input[name=selDate]:checked").val(),fromDate:this.getPicker("#txtFromDate"),toDate:this.getPicker("#txtToDate"),selStatus:$("input[name=selStatus]:checked").val(),selCategories:$(".chooseCategory").chosen().val()||[],isSelectedCategory:function(e){var t=!1;return $.each(this.selCategories,function(){if(e===this||"Alle"===this)return!(t=!0)}),t},selNumber:"max"===$("input[name=selNumber]:checked").val(),cntNumber:0,maxNumber:$("#txtNumberMax").val(),fromNumber:$("#txtNumberFrom").val(),urlChange:$("#chkUrlChange").prop("checked"),newBlogUrl:$("#txtNewBlogUrl").val(),staticImgUrl:"<% staticURL %><% site.alias %>/images/",staticFileUrl:"<% staticURL %><% site.alias %>/files/",wpMediaUrl:"",siteStoriesHref:"<% site.url action="stories" %>".substr("<% site.url %>".indexOf("//")+2),sliceFrom:function(){return parseInt(this.fromNumber,10)-1},sliceTo:function(){return parseInt(this.maxNumber,10)+this.sliceFrom()},properDates:function(){return!this.selDate||0<this.fromDate&&0<this.toDate},validDates:function(){return!this.selDate||this.fromDate<this.toDate},validCategoryNum:function(){return 0<this.selCategories.length},validCategoryMix:function(){return!(0<=$.inArray("Alle",this.selCategories)&&1<this.selCategories.length)},validMaxNumber:function(){return!this.selNumber||!isNaN(parseInt(this.maxNumber,10))},validFromNumber:function(){return!this.selNumber||!isNaN(parseInt(this.fromNumber,10))},validBlogUrl:function(){return!this.urlChange||this.newBlogUrl.indexOf("localhost")||/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/.test(this.newBlogUrl)}};if(t.regStaticImg=new RegExp(t.staticImgUrl.replace("https:","https?:").replace(/\//gi,"\\/"),"gi"),t.regStaticFile=new RegExp(t.staticFileUrl.replace("https:","https?:").replace(/\//gi,"\\/"),"gi"),!this.validateSelectionParams(t))return!1;if(0<t.timeouts.length){var s=t.timeouts.split("/");$.each(s,function(e,t){switch(e){case 0:D.timeoutStories=parseInt(t,10);break;case 1:D.timeoutBody=parseInt(t,10);break;case 2:D.timeoutComments=parseInt(t,10)}})}t.urlChange&&("/"!==t.newBlogUrl.substr(t.newBlogUrl.length-1)&&(t.newBlogUrl+="/"),t.wpMediaUrl=t.newBlogUrl),t.siteId=parseInt(this.musSelectionScreen.siteId),this.params=t,$("#btnIntro, .btnContainer .actionButton").off("click"),this.musStatusScreen.blog=this.musSelectionScreen.blog,this.renderScreen("musStatusScreen"),this.musStory=$("#musStory").text(),this.musPartials.musComment=$("#musComment").text(),this.filelen=0,this.stories.length=0,this.blobList.length=0,this.resourceList.length=0,Object.keys(this.xrefs).forEach(function(e){delete D.xrefs[e]}),this.commentSelectors.initSet(),this.params.debugMode&&(console.log("--------------- Start of blog export process ---------------"),console.log("timeoutStories:",D.timeoutStories,"timeoutBody:",D.timeoutBody,"timeoutComments:",D.timeoutComments),console.log("--------------- Parameter ---------------"),console.log(JSON.stringify(this.params)),console.log("--------------- URL progress ---------------")),this.recursiveStories(0,this.stories)},addExportMenuButton:function(){var e,t;$.each([{test:".message>a",appendTo:"parent"},{test:".modToolbarLeft",appendTo:"self"},{test:"#wrapper",appendTo:"self"},{test:"body",appendTo:"self"}],function(){if(0<(e=$(this.test)).length){switch(t="self"===this.appendTo?e.eq(0):e.eq(0).parent(),this.test.substr(0,3)){case".me":t.append('<button id="msgButton" class="startExport actionButton">Blog exportieren...</button>');break;case".mo":t.append('<span style="display:inline-block;margin-left:30px">&dArr;<a href="#" id="modToolbar-export" class="startExport" style="margin-left:6px">Blog exportieren</a></span>');break;default:t.append('<button id="btnExport" class="startExport actionButton">&or;</button>')}return!1}})},needsGD:function(){var e=D.musSelectionScreen.siteId;return"32208"==e||"697892"==e||"50425"==e},showSelectionScreen:function(){yepnope([{test:D.isFontAwesomePresent(),nope:"https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"},{test:D.needsGD()&&!$.fn.gdimages,yep:"https://static.twoday.net/cdn/files/gdimages-min-js.js"},{test:"videoload"in window,nope:"https://static.twoday.net/cdn/files/videoload2-export-min-js.js"},{test:"undefined"==typeof Autolinker,yep:"https://cdnjs.cloudflare.com/ajax/libs/autolinker/3.14.3/Autolinker.min.js",complete:function(){D.autoLinker=new Autolinker({stripPrefix:!1,className:"autolinker"})}},{test:void 0===$.fn.chosen,yep:["https://cdnjs.cloudflare.com/ajax/libs/chosen/1.1.0/chosen.min.css","https://cdnjs.cloudflare.com/ajax/libs/chosen/1.1.0/chosen.jquery.min.js"],complete:function(){var e=$.get("/topics",function(e){D.musSelectionScreen.categories.length=0,$(e).find(".listItem td>a").each(function(){D.musSelectionScreen.categories.push($(this).text())}),D.renderScreen("musSelectionScreen"),D.needsGD()&&$("#pGoogleDrive").css("display","block"),$(".chooseCategory").chosen({width:"100%"}),yepnope({test:void 0===$.fn.pickadate,yep:["https://cdnjs.cloudflare.com/ajax/libs/pickadate.js/3.6.4/compressed/picker.js","https://cdnjs.cloudflare.com/ajax/libs/pickadate.js/3.6.4/compressed/picker.date.js","https://cdnjs.cloudflare.com/ajax/libs/pickadate.js/3.6.4/themes/classic.css","https://cdnjs.cloudflare.com/ajax/libs/pickadate.js/3.6.4/themes/classic.date.css"],complete:function(){$(".datepicker").pickadate({monthsFull:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthsShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],weekdaysFull:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],weekdaysShort:["So","Mo","Di","Mi","Do","Fr","Sa"],today:"Heute",clear:"Löschen",close:"Schließen",firstDay:1,format:"dd.mm.yyyy",formatSubmit:"yyyy/mm/dd",labelMonthNext:"Nächster Monat",labelMonthPrev:"Vorheriger Monat",labelMonthSelect:"Bitte Monat auswählen",labelYearSelect:"Bitte Jahr auswählen",selectMonths:!0,selectYears:!0})}}),$("#btnVersion").on("click",function(){$.getJSON("https://cdn.jsdelivr.net/gh/NeonWilderness/twodayExport@master/dist/version.json",function(e){var t,s,r,n=!1;$.each(e.packages,function(){if("twodayExport"===this.name)return n=parseFloat(this.version)>parseFloat(D.musSelectionScreen.version),t=this,!1}),r=n?(s="bgYellow",Mustache.render('<i class="fa fa-info-circle"></i>Es existiert eine neuere Version {{version}} vom {{released}}! Bitte <a target="_blank" href="{{url}}">laden</a> Sie die gepackte Layout-Datei herunter, löschen dann das bisherige Layout "twodayExport" und importieren danach die neue Version!',t)):(s="bgGreen",'<i class="fa fa-check"></i>Es gibt keine neuere Exportversion!'),$("#selMessage").html(r).addClass(s).show(0)}).fail(function(){$("#selMessage").html('<i class="fa fa-medkit"></i>Versionsinfos konnten nicht geladen werden.').addClass("bgRed").show(0)})}),$(".btnContainer .actionButton").on("click",function(e){switch(e.preventDefault(),e.target.id){case"btnCancel":D.closeOverlay();break;default:D.exportArticlesAndComments("btnInfosOnly"===e.target.id)}}),$(document).on("keyup",function(e){27===e.which&&D.closeOverlay()}),$("#selOverlay").show(200)}).fail(function(){alert("Fehler beim Lesen der Themenseite: \topics, status: "+e.status+", text: "+e.statusText)})}}])},enableExportFeature:function(){this.addExportMenuButton(),$("body").append($("#mainExport").html()),$(".startExport").on("click",function(e){e.preventDefault(),D.showSelectionScreen()})}};function e(){yepnope([{test:"undefined"==typeof jQuery,yep:["https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"],complete:function(){yepnope([{test:"undefined"==typeof Mustache,yep:["https://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.8.2/mustache.min.js"],complete:function(){D.enableExportFeature()}}])}}])}if(!D.isUserAdministrator())return;if("undefined"==typeof yepnope){var t=document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript",s.src="https://cdnjs.cloudflare.com/ajax/libs/yepnope/1.5.4/yepnope.min.js",s.onload=e,t.appendChild(s)}else e()}()</script>