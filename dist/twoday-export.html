<!-- Client-side Twoday Blog Export on Steroids, (C) 2014-2018 NeonWilderness, https://neonwilderness.twoday.net, MIT license -->
<!-- mustache template for twoday stories -->
<script type="text/x-mustache-template" id="musStory">TITLE: {{&title}}
CATEGORY: {{&category}}
BASENAME: {{&basename}}
DATE: {{date}}
AUTHOR: {{author}}
URL: {{&url}}
STATUS: {{status}}
ALLOW COMMENTS: {{allowcomments}}
-----
BODY:
{{&body}}
-----
{{#comments}}{{>musComment}}{{/comments}}--------
</script>
<!-- mustache template for twoday comments and replies -->
<script type="text/x-mustache-template" id="musComment">{{type}}:
DATE: {{date}}
AUTHOR: {{author}}
URL: {{&url}}
{{&body}}
-----
</script>
<!-- css inline style information for blog export function and main export divs -->
<script type="text/html" id="mainExport">
<style>.actionButton{padding:8px 16px;color:#fff;border-radius:3px;border:none;opacity:.8;cursor:pointer}.actionButton:focus,.actionButton:hover{opacity:1;box-shadow:2px 2px 6px #222}#btnExport{position:fixed;top:50px;left:4px;background:#27ae60;width:38px;height:38px;text-align:center;border-radius:50%;margin-bottom:0;padding:0;z-index:8999}#btnExport:focus,#btnExport:hover{outline:0;border:none}#selOverlay{position:fixed;top:0;left:0;width:100%;height:100%;z-index:9000;background-color:rgba(0,0,0,.6)}#selScreen{width:600px;margin:20px auto;padding:15px;background:#fff;z-index:9001;color:#444}#selScreen button:focus,#selScreen button:hover{outline:0;border:none}#btnIntro,#btnVersion{float:right;font-size:13px;background:#444;border:none;padding:3px 6px;border-radius:10px;color:#fff;cursor:pointer;margin-bottom:0}#btnIntro:focus,#btnIntro:hover,#btnVersion:focus,#btnVersion:hover{color:#ffd055}#selIntro p{font-size:12px;margin-bottom:1em}#selMessage{background:#f04124;color:#fff;padding:10px;margin-bottom:12px;font-size:13px}#selMessage span{display:block}#selMessage i{margin-right:8px}#selHint{font-size:.85em;margin:10px 10px 3px 0;border-left:2px solid #f5f5f5;padding:3px 0 3px 10px;line-height:1.6}#selScreen h3{border-bottom:2px solid #ddd;padding-bottom:10px;font-size:18px}#selScreen h3 span{color:#27ae60;font-size:.95em}#selScreen fieldset{margin:12px 0 0;border:1px solid #ddd;padding:8px 15px 12px;width:100%}#selScreen fieldset table{width:95%;margin:0 auto}#selScreen fieldset .leftCol{width:40%}#selScreen fieldset .statCol{width:20%;text-align:center}#selScreen .btnContainer .actionButton{font-size:14px;margin-bottom:0}#selScreen thead .statCol{color:#777}#selScreen legend{padding:0 8px;font-size:.9em;color:#27ae60}#selScreen legend i{margin-right:8px}#selScreen input[type=text]{display:inline;margin:4px 10px 0;padding:2px 4px;font-family:Arial,Helvetica,sans-serif;font-size:13px}#selScreen input[type=checkbox],#selScreen input[type=radio]{margin-bottom:0}#selScreen label{display:inline}#selScreen label[for=radDateSpan]{margin-right:15px}#btnCancel,#btnInfosOnly,#radNumberMax,#radStatusOffline,#radStatusPublic{margin-left:20px}#txtFromDate,#txtToDate{width:90px;text-align:center}#txtNumberFrom,#txtNumberMax{width:40px;text-align:center}#txtNewBlogUrl{width:315px;margin:0 0 0 4px!important}#wpMediaUrl{font-size:11px}#btnInfosOnly{background:#008cba}#btnCancel{background:#f04124}#btnStartExport,.bgGreen{background:#27ae60!important}.bgYellow{background:#fac000!important}.bgRed{background:#f04124!important}.btnContainer{text-align:center;margin:10px 0 0}.btnContainer i{margin-right:6px}#btnFile,#btnOK{background:#fff;color:#777;cursor:pointer;border:none;border-radius:10px;text-decoration:none;padding:3px 10px}#btnFile{margin-right:10px}#btnFile:hover,#btnOK:hover{color:#444}.picker__select--month,.picker__select--year{padding:0 .5em!important;font-family:Arial,Helvetica,sans-serif;font-size:12px}.chosen-choices,.chosen-results{font-size:14px}a.tip{cursor:help;border-radius:50%;background-color:#eee;width:18px;display:inline-block;line-height:18px;text-align:center;padding:1px}#txtTimeouts{width:110px}#txtVideoWidth{width:48px}#progressBars{font-size:.8rem}.progress{height:1rem}</style>
<div id="selOverlay" style="display:none"><div id="selScreen"></div></div>
</script>
<!-- mustache blog export selection screen template -->
<script type="text/x-mustache-html" id="musSelectionScreen">
<h3>Folgende Beiträge sollen exportiert werden:<button id="btnIntro" class="onSelect"><i class="fa fa-question"></i> Info</button></h3>
<div id="selIntro" style="display:none">
<p>Hallo <b>{{alias}}</b> &mdash; mit diesem Auswahlbildschirm wählen Sie die aus Ihrem Twoday-Blog <b>{{blog}}</b> zu exportierenden Beiträge aus. Sie können Ihre Beiträge nach zeitlichen Kriterien, nach Status (öffentlich/offline), nach Kategorie/n oder nach Anzahl selektieren. Falls Ihre Exportdatei zu groß wird, können Sie mit Hilfe der Zeiteingrenzung oder der Anzahlbegrenzung kleinere Exportpakete erstellen, die Sie separat weiter verarbeiten.</p>
<p><b>Wichtig:</b> Exportdateien können nicht unmittelbar in einen Wordpress-Blog eingespielt werden, sondern müssen über ein spezielles Plugin importiert werden, das z.B. die korrekte Twoday-Kommentarstruktur (Kommentar/Antworten) in Wordpress herstellt. <span style="color:#f04124;font-weight:700">Falls Sie in Ihrem Blog keine Plugins installieren können, aktivieren Sie unten das Auswahlkästchen "Für wordpress.com exportieren".</span> Weitere Details und Informationen finden Sie im zugehörigen <a target="_blank" href="https://neonwilderness.twoday.net/stories/blog-export-on-steroids/">Blogbeitrag</a>.</p>
<p><i class="fa fa-copyright"></i> 2014-2018 <a target="_blank" href="https://neonwilderness.twoday.net">NeonWilderness</a>, Version {{version}}, lizensiert unter <a target="_blank" href="https://opensource.org/licenses/MIT">MIT</a><button id="btnVersion"><i class="fa fa-star-o"></i> Versionscheck</button></p>
<fieldset><legend><i class="fa fa-cogs"></i>Einstellungen</legend>
<input type="checkbox" id="chkAutolink"><label for="chkAutolink">Twoday-Textlinks in klickbare HTML-Links wandeln</label><br>
<input type="checkbox" id="chkDelGuest" checked="checked"><label for="chkDelGuest">(Gast)-Kennung aus Benutzernamen entfernen</label><br>
<input type="checkbox" id="chkKeepImg" checked="checked"><label for="chkKeepImg">&lt;img&gt;-Befehl bei gelöschten Bildern behalten</label><br>
<input type="checkbox" id="chkWrdPress"><label for="chkWrdPress">Für wordpress.com exportieren (fortlaufende Kommentare)</label><a class="tip" title="Wordpress.com erlaubt für Free-User keine Installation eigener Plugins. Daher können Kommentare nur fortlaufend, d.h. ohne strukturelle Einrückungen (Twoday: Antwort auf Kommentar) eingespielt werden."><i class="fa fa-question"></i></a><br>
<input type="checkbox" id="chkDebug"><label for="chkDebug">Testphase: Debug-Nachrichten über Console ausgeben</label><br>
<label for="txtVideoWidth">Videobreite (Videoload-Anwender)<input type="text" id="txtVideoWidth" value="600">Pixel (0=keine iframe-Konvertierung)</label><br>
<label for="txtTimeouts">Timeout-Grenzen (in ms)<input type="text" id="txtTimeouts" placeholder="500/5/5">(keine Eingabe=Standard)<a class="tip" style="margin-left:1rem" title="Nur für erfahrene Benutzer: Wartezeiten zwischen Serverzugriffen für Stories/Body/Comment; einzugeben in der Form nnnn/nnnn/nnnn, wobei nnnn=Millisekundenzahl"><i class="fa fa-question"></i></a></label>
</fieldset>
</div>
<div id="selMessage" style="display:none"></div>
<div id="selOptions">
<fieldset><legend><i class="fa fa-calendar"></i>Zeitliche Eingrenzung</legend>
<input type="radio" name="selDate" value="all" id="radDateAll" checked="checked"><label for="radDateAll">Alle</label><br/>
<input type="radio" name="selDate" value="dates" id="radDateSpan"><label for="radDateSpan">Zeitspanne:</label>
<label for="txtFromDate">Von-Datum<input type="text" id="txtFromDate" class="datepicker"></label>
<label for="txtToDate">Bis-Datum<input type="text" id="txtToDate" class="datepicker"></label>
</fieldset>
<fieldset><legend><i class="fa fa-tag"></i>Status</legend>
<input type="radio" name="selStatus" value="main" id="radStatusAll" checked="checked"><label for="radStatusAll">Alle</label>
<input type="radio" name="selStatus" value="mystories" id="radStatusPublic"><label for="radStatusPublic">Nur Veröffentlichte</label>
<input type="radio" name="selStatus" value="offline" id="radStatusOffline"><label for="radStatusOffline">Nur Unveröffentlichte</label>
</fieldset>
<fieldset><legend><i class="fa fa-th-large"></i>Kategorie</legend>
<select data-placeholder="Bitte Kategorie/n auswählen..." multiple="multiple" style="width:100%" class="chooseCategory">
<option selected="selected">Alle</option>
<option>Unkategorisiert</option>
<option>Unveröffentlicht</option>
{{#categories}}<option>{{.}}</option>{{/categories}}
</select>
</fieldset>
<fieldset><legend><i class="fa fa-list-ol"></i>Anzahl</legend>
<input type="radio" name="selNumber" value="all" id="radNumberAll"><label for="radNumberAll">Alle</label>
<input type="radio" name="selNumber" value="max" id="radNumberMax" checked="checked"><label for="radNumberMax">Maximal<input type="text" id="txtNumberMax" value="10">Beiträge,&nbsp;</label> <label for="txtNumberFrom">Start ab Beitrag<input type="text" id="txtNumberFrom" value="1"></label>
</fieldset>
<fieldset><legend><i class="fa fa-image"></i>Bildadressen</legend>
<input type="checkbox" id="chkUrlChange"><label for="chkUrlChange" style="margin-right:0">Twoday-Bild-URLs ändern auf</label>
<input type="text" id="txtNewBlogUrl" placeholder="https://www.meinneuerblog.me/wp-content/uploads">
</fieldset>
<div class="btnContainer">
<button id="btnStartExport" class="actionButton">Export starten...</button>
<button id="btnInfosOnly" class="actionButton">Nur Infos (Probelauf)...</button>
<button id="btnCancel" class="actionButton">Abbrechen</button>
</div>
</div>
</script>
<!-- mustache blog export status template -->
<script type="text/x-mustache-html" id="musStatusScreen">
<h3>Export Blog <span>{{blog}}</span> in Bearbeitung...<button id="btnIntro" class="onStatus"><i class="fa fa-question"></i> Info</button></h3>
<div id="selIntro" style="display:none">
<p>Während des Exports angezeigte Fehler sind i.d.R. Timeout-Lesefehler, d.h. dass die ent&shy;sprechenden Beiträge nicht in der regulären Zeit erfolgreich gelesen werden konnten. Timeouts entstehen bei schlechtem Antwort&shy;zeit&shy;verhalten des Twoday-Servers bzw. der Helma-Datenbank.</p>
<p>Nach einem Lesefehler wird der Exportlauf abgebrochen, da sonst die Exportdatei unvollständig wäre. Bitte versuchen Sie es dann erneut zu anderen Zeiten.</p>
<p><i class="fa fa-copyright"></i> 2014-2018 <a target="_blank" href="https://neonwilderness.twoday.net">NeonWilderness</a>, lizensiert unter <a target="_blank" href="https://opensource.org/licenses/MIT">MIT</a></p>
</div>
<fieldset><legend><i class="fa fa-dashboard"></i>Exportfortschritt</legend>
<table>
<thead>
<tr>
<th class="leftCol"></th>
<th class="statCol">gelesen</th>
<th class="statCol">selektiert</th>
<th class="statCol">exportiert</th>
</tr>
</thead>
<tbody>
<tr>
<td class="leftCol">Beiträge (öffentlich)</td>
<td class="statCol" id="pubArtRead">0</td>
<td class="statCol" id="pubArtSelected">0</td>
<td class="statCol" id="pubArtWrite">0</td>
</tr>
<tr>
<td class="leftCol">Beiträge (offline)</td>
<td class="statCol" id="offArtRead">0</td>
<td class="statCol" id="offArtSelected">0</td>
<td class="statCol" id="offArtWrite">0</td>
</tr>
<tr>
<td class="leftCol">Beitragstexte</td>
<td class="statCol" id="styRead">0</td>
<td class="statCol"></td>
<td class="statCol" id="styWrite">0</td>
</tr>
<tr>
<td class="leftCol">Kommentare</td>
<td class="statCol" id="comRead">0</td>
<td class="statCol"></td>
<td class="statCol" id="comWrite">0</td>
</tr>
<tr>
<td class="leftCol">Antworten auf Kommentare</td>
<td class="statCol" id="repRead">0</td>
<td class="statCol"></td>
<td class="statCol" id="repWrite">0</td>
</tr>
</tbody>
</table>
</fieldset>
<fieldset>
<div id="progressBars">
<div class="row">
<div class="small-3 columns">Übersichtsdaten</div>
<div class="small-9 columns"><div class="progress"><span id="mMain" class="meter" style="width:1%"></span></div></div>
</div>
<div class="row">
<div class="small-3 columns">Beiträge</div>
<div class="small-9 columns"><div class="progress"><span id="mStories" class="meter" style="width:1%"></span></div></div>
</div>
<div class="row">
<div class="small-3 columns">Kommentare</div>
<div class="small-9 columns"><div class="progress" style="margin-bottom:0"><span id="mComments" class="meter" style="width:1%"></span></div></div>
</div>
</div>
</fieldset>
<div id="selMessage" class="{{msgColor}}" style="display:none;margin-bottom:0"><span></span><span id="selHint" style="display:none">Klicken Sie auf "Datei...", um die aufbereiteten Blogdaten dauerhaft in die Exportdatei <b>"{{filenameExport}}"</b> zu speichern. Die Übersichtsliste statischer Twoday-Bilder wird in Datei <b>"{{filenameResourceList}}"</b> bereitgestellt.</span><span class="btnContainer"><a id="btnFile" href="#" target="_blank" title="Blogdaten speichern" style="display:none"><i class="fa fa-fw fa-download"></i>Datei...</a><a id="btnOK" href="#" title="Fenster schließen"><i class="fa fa-fw fa-check"></i>OK</a></span></div>
</script>
<!-- mustache template for list of static twoday images and url changes -->
<script type="text/x-mustache-html" id="musResourceList"><!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Statische Twoday-Bildadressen</title>
<style>body{background:#fff;color:#444;padding:10px 20px;font-family:Tahoma,sans-serif}#wrapper{width:800px;margin:0 auto}h3 span{color:#27ae60;font-weight:400;font-size:.9em}.hint{font-size:.8em;background-color:#f5f5f5;border-top:2px solid #666;border-bottom:2px solid #666;padding:10px}</style>
</head>
<body>
<div id="wrapper">
<h3>Liste der gefundenen Twoday-Ressourcen für <span>{{&blog}}</span></h3>
<p class="hint">
Die nachstehende Auflistung enthält alle Ressourcen der während des Exportlaufs selektierten Beiträge, die ein auf Twoday gespeichertes Bild (Bildadresse beginnt mit "{{&staticImgUrl}}") oder eine Datei (Dateiadresse beginnt mit "{{&staticFileUrl}}") verwenden. {{#urlChange}}Gemäß Ihrer Anforderung wurden alle diese Adressen in der Exportdatei auf das neue Blog-Medienverzeichnis "{{wpMediaUrl}}" geändert.{{/urlChange}}
</p>
{{#storyResources}}{{&.}}{{/storyResources}}
</div>
</body>
</html>
</script>
<style>#msgButton{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAAEEfUpiAAAACXBIWXMAAFxGAABcRgEUlENBAAAACXRFWHRDb21tZW50AACJKo0GAAAEcklEQVR4nI1XTUxUVxQeCIkGlkBcwKKbbkiEjO1CdIGrBmqNsc5CDG6aYUNDHMIkRhfuSNwMie0CTNMOGd1QRCNGE40NxkXTJo2pojFuABPxB5VgYDTNDHN6v+G78867770ZXnKY9+499zvfPff8XGIiEoMkk8k0fssfLRclc/EfkfKAmRk1A+UHvzG7hIMxu77FTuDjAWYh5n17NJ4VKYkHKkpjOaZ4LIoyAkW7otla1XSIUO+j9ePdgEK3D9JIJ9/PGVmq7EMpnTRySI/ZiU3YU4oDRhKW5FnL4cQNn/0Gq7BiBjYw+O9bT8HIbjNXgMIQBorGVU/fi7T+JPLFRFlhvOxKem7S+uDlRsUfmLuPP43kUFDwKTM+oXcRN7LgujngB+UkoSwYuWNkjd/r1mIAwEzkjZwnnQ4jJUUJMke9OoLFNUXhwja96OEb/9lS8lyTNZLCS7+RMR0xVh6vhgJA0tYw/vQYyWmAUze3F374LJXnTd4H0FsB4MtHI10uizP3RRbXA9YHuWbLSKt2YoLOaSJQu5FfjNwyMqz0po2UIo+RSgiEojpOyLxO36oABDmEesEcCSwMBUCQMFiEwXOHwWRZnIsEUD4YiGBUj8qB5AzL2DgX19GBc47nEZUd1D2PqHUBKhmsF06Z9Pnykg8oQ/0HthJYj2e5OK8B8By7FoiDNh3+eClgf2ZilxuyeI5cDQBsEGAFRVMnUjoM4NuZYC4QYAx5pAEymOyf88IXzzfTIhf+EvlzJQAwhO6hAXqtQmFLZI2J9Hpz+/fA5QBADolYLmyo4e4JlLxElK+nfFuYdJ3YiswiwKDrg87fQvffhQzWcbBsqygqakgBgRRUVIqtjTpUS0hV+40UZiojpdup08TFiahkWgpLGrQ1lVTxqumM1GXu61qA2pCqmc5RQtAUgd1C4xqap25kDdkRAWb4kgKHC9C0Oqus6aSOrkFLrttquTDBAxXW3yY9z1o9rOq1Pehhe9gKq4kYQsxEJAFW02UqTzhGU07zryXQTTlkJoi9nFTt3U42s5SjVXUpw4NRRv5+5WXq99erkhlUJLpoA7aaNQEbtd3K+GS1XT586xE4OlvTI5OKRDdtzdtS0sOBnDLeV8vNj1Y9At+FlNwQ6VMkcrRZLoaj/BhSBMZdgMMz/vb05J1HoPd3b/zgFZE9P4cSGFcEhmhz1F6u8DGmCPiay3Fzxv8Vt42hvMPIs/ceAXSt2efe9+onka+mAgTSisAYbfbbACyyxdWTANrjhruLH26LbOk+4Twgtz8Xuntg7aLxetoqllsqB0fIKKu8gLtqPgRMRv7wG35hGsu+bOTZA6NN7T5LWyOVLOCEvZrjytGgiGSiAuv0PZG9v1YNvIzCbyC2r9mEld88lXCBqlNEcO3Hhcu9+mspUadDYdYRS4hdvZuJV443uQjXwYGk+l+tlvCcB7hWiBUow5EEFFAjj8ZeeK2sJb3/oOwFeM3RWefaxmo2drQjhxRaM67uuLank94VHmM7asFa/gdN40X5ePFv7gAAAABJRU5ErkJggg==) no-repeat #ccc 1em center;padding:16px 16px 17px 4em;opacity:1;border-radius:0;box-shadow:none;margin-left:15px}#msgButton:hover{background-color:#666}</style>
<div id="exportLoginStatus" style="display:none"><% site.loginstatus %></div>
<script type="text/javascript">!function(){"use strict";var e={isUserAdministrator:function(){var e=document.getElementById("exportLoginStatus"),t=(e.textContent||e.innerText).match(/\((.*)\)/);return!!t&&"Administrator"===t[1]},isFontAwesomePresent:function(){var e=!1;return $.each(document.styleSheets,function(){return!(e=(this.href||"").indexOf("font-awesome.min.css")>=0)}),e},musSelectionScreen:{alias:"<% site.alias %>",blog:"<% site.href %>",version:"1.0",categories:[]},musStatusScreen:{pubArtRead:0,pubArtSelected:0,pubArtWrite:0,offArtRead:0,offArtSelected:0,offArtWrite:0,styRead:0,styWrite:0,comRead:0,comWrite:0,repRead:0,repWrite:0,filenameExport:"<% site.alias %> export.txt",filenameResourceList:"<% site.alias %> url liste.html",init:function(e){this.pubArtRead=0,this.pubArtSelected=0,this.pubArtWrite=0,this.offArtRead=0,this.offArtSelected=0,this.offArtWrite=0,this.styRead=0,this.styWrite=0,this.comRead=0,this.comWrite=0,this.repRead=0,this.repWrite=0,this.startTime=(new Date).getTime(),this.isTestRun=e},incValue:function(e,t){var s=void 0===t?1:t;this[e]+=s,document.getElementById(e).innerText=this[e]},startTime:null,timeUsed:function(){var e=Math.floor(((new Date).getTime()-this.startTime)/1e3),t=Math.floor(e/3600),s=Math.floor((e-3600*t)/60),r=e-3600*t-60*s;return t<10&&(t="0"+t),s<10&&(s="0"+s),r<10&&(r="0"+r),t+":"+s+":"+r}},musStory:"",musPartials:{},filelen:0,stories:[],blobList:[],resourceList:[],xrefs:{},timeoutStories:500,timeoutBody:5,timeoutComments:5,autoLinker:null,getPicker:function(e){var t=$(e).pickadate().pickadate("picker").get("select");return null===t?0:t.pick},validateSelectionParams:function(e){var t="";return e.properDates()?e.validDates()?e.validCategoryNum()?e.validCategoryMix()?e.validMaxNumber()?e.validFromNumber()?e.validBlogUrl()||(t="validBlogUrl"):t="validFromNumber":t="validMaxNumber":t="validCatMix":t="validCatNum":t="validDates":t="properDates",t.length>0?($("#selMessage").html({properDates:"Bitte geben Sie bei gewählter Zeiteingrenzung ein gültiges Von- und Bis-Datum ein!",validDates:"Das Bis-Datum muss größer als das Von-Datum sein!",validCatNum:"Bitte wählen Sie mindestens eine Kategorie aus (z.B. 'Alle')!",validCatMix:"Entfernen Sie die 'Alle'-Kategorie, wenn Sie einzelne Kategorien selektieren wollen!",validMaxNumber:"Bitte geben Sie bei gewählter Anzahlbegrenzung eine gültige <b>Beitragsanzahl</b> ein!",validFromNumber:"Bitte geben Sie bei gewählter Anzahlbegrenzung eine gültige <b>Startnummer</b> ein!",validBlogUrl:"Zur Adressanpassung der Twoday-Bilder bitte eine gültige neue Blogadresse eingeben!"}[t]).show(),!1):($("#selMessage").html("").hide(),!0)},renderScreen:function(e){var t=Mustache.render($("#"+e).html(),this[e]);$("#selScreen").html(t),$("#btnIntro").on("click",function(e){e.preventDefault();var t=$(this);t.hasClass("onSelect")&&($("#selMessage").html("").attr("class","").hide(),$("#selOptions").toggle(0)),$("#selIntro").toggle(0),t.find("i").toggleClass("fa-question fa-times")})},filterStory:function(e){var t,s=!1;return this.params.selDate&&(s=(t=Date.parse(e.date))<this.params.fromDate||t>this.params.toDate),s||"mystories"!==this.params.selStatus||(s="draft"===e.status),s||(s=!this.params.isSelectedCategory(e.category)),s},closeOverlay:function(){$(document).off("keyup"),$("#selOverlay").hide(400)},renderMessage:function(t,s){$("#selMessage>span:first").text(t).parent().addClass(s).show(400),$("#btnOK").on("click",function(t){t.preventDefault(),e.closeOverlay()})},renderWarning:function(){this.renderMessage("Für die gewählten Filterkriterien wurden keine Beiträge gefunden!","bgYellow")},renderError:function(e){this.renderMessage(e,"")},recursiveStories:function(t,s){var r="/stories/"+this.params.selStatus+"?page="+t,n=$.get(r,function(n){var i,a,o,l,c=$(n).find(".admin");e.params.debugMode&&console.log("Read story overview page: ",r),c.find(".listItem").each(function(){var t=$(this),r=t.find(".leftCol"),n={};n.title=$.trim(t.find("tr>td>b").text()),o=r.text(),n.id=o.match(/id="(.*)"/)[1],l=o.match(/Status: (.*)\s/)[1].split(",")[0].split(" in "),n.status="online"===l[0]?"publish":"draft",o=r.find("a[href*=topics]").eq(0).text(),n.category=o.length>0?o:"publish"===n.status?"Unkategorisiert":"Unveröffentlicht",o=r.find(">span").eq(2),l=o.text(),n.author=l.match(/erstellt von (.*) am/)[1],e.params.delGuest&&(n.author=n.author.replace(" (Gast)","")),l=l.match(/ am (.*)/)[1],n.date=l.substr(6,4)+"-"+l.substr(3,2)+"-"+l.substr(0,2)+l.substr(10),l=o.find(">a"),n.url=l.length>0?l.attr("href"):"",e.musStatusScreen.incValue("publish"===n.status?"pubArtRead":"offArtRead"),e.filterStory(n)||s.push(n)});var u=c.find(".pageNavSummary:first");if(0===u.length?i=0:(a=parseInt(u.text().split(" ")[3],10),i=Math.floor(a/20)),t<i)document.getElementById("mMain").style.width=20*(t+1)/a*100+"%",setTimeout(function(){return e.recursiveStories(t+1,s)},e.timeoutStories);else{if(s.length>0){document.getElementById("mMain").style.width="100%",s.sort(function(e,t){return Date.parse(t.date)-Date.parse(e.date)});var m=s[s.length-1].id;return e.params.oldestIDLen=m.length,e.params.oldestIDVal=parseInt(m),e.params.selNumber&&(e.stories=s.slice(e.params.sliceFrom(),e.params.sliceTo())),e.recursiveBody(0,e.stories)}e.renderWarning()}}).fail(function(){e.params.debugMode&&console.log(">>>Fail to read storyPage: ",r,n.status,n.statusText),e.renderError("Fehler beim Lesen der Beitragsübersichtsseite: "+r+", status: "+n.status+", text: "+n.statusText)})},convertNiceUrlToStoryID:function(t,s){if("storyID"in s){if(s.storyID.length>0)for(var r,n=e.params.siteStoriesHref+"/",i=new RegExp(n+t,"gi"),a=n+s.storyID,o=0,l=s.refIdx,c=l.length;o<c;++o)(r=e.stories[l[o]]).body=r.body.replace(i,a);e.params.debugMode&&console.log("convertNiceUrlToStoryID: slug="+t+", storyID="+s.storyID+", #stories="+s.refIdx.length)}else console.log(">>> Missing storyID field in: "+t+" - xref-Object: "+JSON.stringify(s))},addMissingNiceUrlStoryIDs:function(t,s){var r=s[t],n=e.xrefs[r];if(n.storyID.length>0)return e.convertNiceUrlToStoryID(r,n),(t+=1)<s.length?e.addMissingNiceUrlStoryIDs(t,s):e.renderStories();var i="/stories/"+r,a=$.get(i,function(i){var a=$(i).find(".story");if(n.storyID=a.attr("data-storyid"),e.convertNiceUrlToStoryID(r,n),!((t+=1)<s.length))return e.renderStories();setTimeout(function(){return e.addMissingNiceUrlStoryIDs(t,s)},e.timeoutBody)}).fail(function(){if(e.params.debugMode&&console.log(">>>Fail to read source story: ",i,a.status,a.statusText),!((t+=1)<s.length))return e.renderStories();setTimeout(function(){return e.addMissingNiceUrlStoryIDs(t,s)},e.timeoutBody)})},assignNiceUrlsStoryID:function(){var t=this.xrefs,s=Object.keys(t).length;if(0!==s){var r=0;$.each(this.stories,function(e,s){var n=s.basename.substr(0,s.basename.lastIndexOf("-"));void 0!==t[n]&&(t[n].storyID=s.id,r++)}),e.params.debugMode&&console.log("End of assignNiceUrlsStoryID: #xrefs=",s,"#IDs found=",r)}},isNiceUrl:function(t){return 0!==t.length&&(!$.isNumeric(t)||t.length<e.params.oldestIDLen&&parseInt(t)<e.params.oldestIDVal)},saveNiceUrlXrefs:function(t,s){var r,n,i,a,o;$("<div>").html(t.body).find('a[href*="'+e.params.siteStoriesHref+'"]').each(function(){if(null===(r=this.href.match(/\/stories\/(.*)\/?/)))return!0;if(n=(n=(n=r[1].split("#")[0]).split("?")[0]).split("/")[0],e.isNiceUrl(n))if(void 0===e.xrefs[n])e.xrefs[n]={storyID:"",refIdx:[s]},e.params.debugMode&&console.log("Init xref: "+n+" in basename: "+t.basename);else{for(i=0,o=e.xrefs[n],a=o.refIdx.length;i<a&&o.refIdx[i]!==s;++i);i>=a&&e.xrefs[n].refIdx.push(s)}})},legitSlugChars:function(e){return e.toLowerCase().replace(/ä/g,"ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/ß/g,"ss").replace(/[^\w ]+/g,"").trim().replace(/ +/g,"-")},transformVideoloadRefs:function(t){if(t.indexOf("html5video")<0)return t;var s=$("#workDiv"),r=$("<div>").html(t),n=r.find(".html5video");return n.each(function(t,r){var n=r.className.match(/width-[0-9]+/),i="width-"+e.params.videowidth;n?r.className.replace(n[0],i):r.className+=" "+i,s.append($(r).clone())}),window.video2day.run({exportRun:!0}),s.find(".html5video").each(function(e,t){n.eq(e).html(t.dataset.content)}),s.empty(),r.html()},staticURL:"https://static.twoday.net",sanitizeLinks:function(e){e=(e=e.replace(/http:\/\/static\.twoday\.net/gi,this.staticURL)).replace(/https?:\/\/twoday\.net\/static/gi,this.staticURL);var t="<% site.href %>".match(/https?:\/\/(.+)\//)[1],s=new RegExp('"//'+t,"gi");return e=e.replace(s,'"https://'+t)},recursiveBody:function(t,s){var r=s[t],n="/stories/"+r.id+"/edit";this.musStatusScreen.incValue("publish"===r.status?"pubArtSelected":"offArtSelected");var i=$.get(n,function(i){var a=$(i).find(".admin"),o=a.find("#modNiceUrlsText").text();if(r.body=a.find(".formText").text(),e.params.debugMode&&console.log("Read source of story: ",n),r.body=e.sanitizeLinks(r.body),e.params.videowidth>0&&(r.body=e.transformVideoloadRefs(r.body)),e.params.autoLink&&(r.body=e.autoLinker.link(r.body)),0===o.length&&0===(o=e.legitSlugChars(r.title)).length&&(o="notitle"),r.basename=o+"-"+r.id,r.allowcomments=Math.abs(!a.find("#discussions").prop("checked")-1).toString(),e.saveNiceUrlXrefs(r,t),e.musStatusScreen.incValue("styRead"),!((t+=1)<s.length))return e.params.debugMode&&console.log(">>> xrefs:",JSON.stringify(e.xrefs,null,2)),document.getElementById("mStories").style.width="100%",e.recursiveComments(0,s);document.getElementById("mStories").style.width=t/s.length*100+"%",setTimeout(function(){return e.recursiveBody(t,s)},e.timeoutBody)}).fail(function(){e.params.debugMode&&console.log(">>>Fail to read source story: ",n,i.status,i.statusText),e.renderError("Fehler beim Lesen des Beitrags: "+n+", status: "+i.status+", text: "+i.statusText)})},selectorsStandard:{set:"Standard",comments:".comments",commentDate:">.commentDate|text",commentAuthor:">.commentDate>a|text",commentUrl:">.commentDate>a|href",commentTitle:">h4|text",commentBody:">div:nth-child(3)|html",reply:">.reply",d2:function(e){return(""+e).length<2?"0"+e:""+e},months:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],getMonth:function(e){return $.inArray(e,this.months)+1},extractDate:function(e,t){var s=e.split(" - ")[1],r=s.match(/(.*)\./)[1],n=this.getMonth(s.match(/\s(.*)\,/)[1]),i=t.substr(0,4),a=s.match(/\, (.*)/)[1];return s=i+"-"+this.d2(n)+"-"+this.d2(r)+" "+a,Date.parse(s)<Date.parse(t)?(parseInt(i,10)+1).toString()+s.substr(4):s},anonymousAuthor:function(e){return e.find(">.commentDate").text().split(" - ")[0]}},selectorsLayout:{set:"Layout",comments:".comments",commentDate:">.commentDate|text",commentAuthor:">.commentDate>a|text",commentUrl:">.commentDate>a|href",commentTitle:">h4|text",commentBody:">div:nth-child(3)|html",reply:">.reply",extractDate:function(e){return e.split(" - ").pop()},anonymousAuthor:function(e){return e.find(">.commentDate").text().split(" - ")[0]}},selectorsFoundation:{set:"Foundation",comments:".comments",commentDate:".commentDate:first>span|title",commentAuthor:".commentUser:first>a|text",commentUrl:".commentUser:first>a|href",commentTitle:".commentTitle:first|text",commentBody:".commentText:first|html",reply:">.reply",extractDate:function(e){return e.substr(0,16)},anonymousAuthor:function(e){return e.find(".commentUser:first").text().match(/(.*)\s/)[1]}},commentSelectors:{sets:[{id:"Layout",checkfor:"#exportLayout"},{id:"Foundation",checkfor:"#f5Body"},{id:"Standard",checkfor:""}],initSet:function(){$.each(this.sets,function(){if(0===this.checkfor.length||$(this.checkfor).length>0)return $.extend(e.commentSelectors,e["selectors"+this.id]),!1})},retrieveDOMValue:function(e,t){var s=this[t].split("|"),r=e.find(s[0]).eq(0);if(!(r.length>0))return"";switch(s[1]){case"text":return r.text();case"html":return r.html();default:return r.attr(s[1])}}},recursiveComments:function(t,s){var r=s[t],n="/stories/"+r.id,i=this.commentSelectors,a=this.params;function o(e){if(!e.length)return"";if(e.indexOf("/")>=0){var t=e.split("/");if("<% site.alias %>"!==t[0])return"";e=t[1]}for(var s,n=0,i=r.images.length;n<i;++n)if(e===(s=r.images[n]).split(".")[0])return s;return a.keepImg?(e+=".jpg",r.images.push(e),"|"+e):""}function l(e){var t=e.name||"";if(t&&r.files.hasOwnProperty(t)){var s=r.files[t];return s.name=t,Mustache.render('<a target="_blank" href="{{&url}}">{{&name}} ({{&ext}})</a>',s)}return""}function c(e){var t=function(t,s){e[t]&&(e[t]=" "+t+"="+(s?'"'+e[t]+'"':e.prop))};if(!e.fullName){var s=o(e.name||"");if(0===s.length)return"";"|"===s.charAt(0)&&(s=s.substr(1),e.class?e.class+=" notFound":e.class="notFound"),e.fullName=a.staticImgUrl+s}return t("align",!0),t("border",!0),t("class",!0),t("height",!0),e.href&&(e.linkto=e.href),t("target",!0),t("width",!0),Mustache.render('{{#linkto}}<a{{&target}} href="{{&linkto}}">{{/linkto}}<img src="{{&fullName}}"{{&class}}{{&align}}{{&width}}{{&height}}{{&border}}>{{#linkto}}</a>{{/linkto}}',e)}function u(e){return e.to=e.to||"",e.text=e.text||e.to,e.target&&(e.target=' target="'+e.target+'"'),Mustache.render('<a{{#target}}{{&target}}{{/target}} href="{{&to}}">{{&text}}</a>',e)}function m(e,t,s){var r=s.find("table.gallery").eq(t).css("width","100%").addClass("regenerated");return r.find("a").each(function(){this.innerHTML=c({fullName:this.href,width:"100%"})}),r[0].outerHTML}function d(e){if(e.indexOf('"gallery')<0)return e;var t=$("<div>").html(e);return t.find("table.gallery").not(".regenerated").each(function(e,t){$(t).css("width","100%").addClass("manual").find("a").each(function(){var e=this.href.split("/").pop().split(".")[0],t=a.staticImgUrl+o(e);this.outerHTML=c({href:t,fullName:t,width:"100%"})})}),t.html()}function h(e,t,s){e.id=e.id.split("/").reverse()[0];var r=s.find("#twodayPoll-"+e.id);return r.length?r[0].outerHTML:""}function f(e){return u({to:"<% site.href %>stories/"+r.id,text:e.text||"Link zum Beitrag"})}function p(e){return"<% site.href %>stories/"+r.id}function g(e,t){var s=new RegExp(t?" ":" ","g"),r=t?" ":" ",n=e.match(/(".*?")/g);return n&&n.map(function(t){e=e.replace(t,t.replace(s,r))}),e}function b(e,t,s,r){var n=new RegExp("<\\%\\s*"+s+"\\s.*\\s*%>","gi"),i=e.match(n);return i&&i.map(function(s,n){var i=g(s.substr(2,s.length-4).trim(),!0).split(" ").reduce(function(e,t){var s=t.indexOf("=");if(s>=0){var r=t.substr(0,s),n=t.substr(s+1);e[r]=g(n,!1).replace(/^["'](.+)["']$/,"$1")}return e},{});e=e.replace(s,r(i,n,t))}),e}function y(e){return a.urlChange?e.replace(a.regStaticImg,a.wpMediaUrl):e}function v(e,t){var s;return[{tag:"file",cb:l},{tag:"gallery",cb:m},{tag:"image",cb:c},{tag:"link",cb:u},{tag:"poll",cb:h},{tag:"story\\.link",cb:f},{tag:"story\\.url",cb:p}].map(function(s){e=b(e,t,s.tag,s.cb)}),e=y(e=d(e)),s=e,a.urlChange?s.replace(a.regStaticFile,a.wpMediaUrl):s}function x(t,s,n){var o={},l=i.retrieveDOMValue(t,"commentTitle"),c=i.retrieveDOMValue(t,"commentBody"),u=i.retrieveDOMValue(t,"commentDate");return o.date=i.extractDate(u,r.date),o.type=s,o.author=i.retrieveDOMValue(t,"commentAuthor"),0===o.author.length&&(o.author=i.anonymousAuthor(t)),a.delGuest&&(o.author=o.author.replace(" (Gast)","")),o.url=i.retrieveDOMValue(t,"commentUrl"),o.body=d(l.length>0?l+" "+c:c),o.body=y(o.body),a.videowidth>0&&(o.body=e.transformVideoloadRefs(o.body)),e.musStatusScreen.incValue("C"===n?"comRead":"repRead"),o}var S=$.get(n,function(o){var l,c,u=$(o).find("#content");e.params.debugMode&&console.log("Read rendered story: ",n),r.images=[],u.find("img").each(function(){(l=this.src||"").match(a.regStaticImg)&&(c=l.substr(l.lastIndexOf("/")+1).replace("_small.","."),r.images.indexOf(c)<0&&r.images.push(c))}),r.files={},u.find(".fileMacro").each(function(){r.files[this.dataset.name]={url:this.dataset.url,ext:this.dataset.ext}}),r.body=v(r.body,u),r.comments=[];var m=u.find(i.comments);if(r.cntComments=m.length,r.cntReplies=0,m.each(function(){var e,t=$(this);if(!((e=t).text().indexOf("/modTrackback")>=0||e.find('a[name="trackbacks"]').length>0)){r.comments.push(x(t,"COMMENT","C"));var s=t.find(i.reply);r.cntReplies+=s.length,s.each(function(){var e=$(this);r.comments.push(x(e,a.typeReply,"R"))})}}),!((t+=1)<s.length)){document.getElementById("mComments").style.width="100%",e.assignNiceUrlsStoryID();var d=Object.keys(e.xrefs);return d.length>0?e.addMissingNiceUrlStoryIDs(0,d):e.renderStories()}document.getElementById("mComments").style.width=t/s.length*100+"%",setTimeout(function(){return e.recursiveComments(t,s)},e.timeoutComments)}).fail(function(){e.params.debugMode&&console.log(">>>Fail to read rendered story: ",n,S.status,S.statusText),e.renderError("Fehler beim Lesen der Beitrags: "+n+", status: "+S.status+", text: "+S.statusText)})},renderStory:function(t){var s=Mustache.render(this.musStory,t,this.musPartials);return this.filelen+=s.length,e.params.debugMode&&console.log("Render export for story: ",t.basename,"FileLen: ",this.filelen),s},mergeImageAndFileResources:function(e){var t,s=[];return e.images.map(function(e){s.push({isImage:!0,name:e,source:this.params.staticImgUrl+e})},this),Object.keys(e.files).map(function(r){t=e.files[r],s.push({isImage:!1,name:r+"."+t.ext,source:t.url})}),s},renderResourceList:function(e){var t={id:e.id,title:e.title,date:e.date,resources:this.mergeImageAndFileResources(e)},s={resource:'<li><a class="resource {{#isImage}}image{{/isImage}}{{^isImage}}file{{/isImage}}" target="_blank" href="{{&source}}">{{name}}</a>{{^isImage}} (Datei){{/isImage}}'+(this.params.urlChange?" geändert in "+this.params.wpMediaUrl+"{{name}}":"")+"</li>"},r=Mustache.render('<p><div>Beitrag: <a target="_blank" href="<% site.href %>stories/{{id}}">{{title}}</a> vom {{date}}:</div><ol>{{#resources}}{{>resource}}{{/resources}}</ol></p>',t,s);this.resourceList.push(r)},renderStories:function(){var t,s=this.blobList,r=this.musStatusScreen,n=!r.isTestRun;$.each(this.stories,function(){t=e.renderStory(this),n&&(s.push(t),r.incValue("publish"===this.status?"pubArtWrite":"offArtWrite"),r.incValue("styWrite"),r.incValue("comWrite",this.cntComments),r.incValue("repWrite",this.cntReplies)),(this.images.length||this.files.length)&&e.renderResourceList(this)}),this.renderInfoMessage()},writeExportFile:function(){var e=new Blob([this.blobList.join("")],{type:"text/plain;charset=utf-8"});window.saveAs(e,this.musStatusScreen.filenameExport);var t,s,r=$("#musResourceList").html(),n=$.extend({},this.musSelectionScreen,{storyResources:this.resourceList},this.params);0===this.resourceList.length&&this.resourceList.push("<p>*** Keine statischen Twoday-Bildadressen gefunden. ***</p>"),t=Mustache.render(r,n),s=new Blob([t],{type:"text/html;charset=utf-8"}),window.saveAs(s,this.musStatusScreen.filenameResourceList)},renderInfoMessage:function(){var t=Mustache.render("Export{{#isTestRun}}testlauf{{/isTestRun}} ohne Fehler beendet nach {{timeUsed}} (hh:mm:ss), "+Math.round(this.filelen/1024)+" KB",this.musStatusScreen);$("#selMessage>span:first").html(t).parent().addClass("bgGreen").show(400),e.params.debugMode&&console.log("--------------- End of blog export process ---------------"),this.musStatusScreen.isTestRun||yepnope([{test:void 0===window.saveAs,yep:["https://static.twoday.net/cdn/files/filesaver-min-js.js"],complete:function(){$("#selHint, #btnFile").show(),$("#btnFile").on("click",function(t){t.preventDefault(),e.writeExportFile()})}}]),$("#btnOK").on("click",function(t){t.preventDefault(),e.closeOverlay(),e.stories.length=0,e.blobList.length=0})},exportArticlesAndComments:function(t){this.musStatusScreen.init(t);var s={autoLink:$("#chkAutolink").prop("checked"),delGuest:$("#chkDelGuest").prop("checked"),keepImg:$("#chkKeepImg").prop("checked"),typeReply:$("#chkWrdPress").prop("checked")?"COMMENT":"REPLY",debugMode:$("#chkDebug").prop("checked"),videowidth:parseInt($("#txtVideoWidth").val()),timeouts:$("#txtTimeouts").val(),selDate:"dates"===$("input[name=selDate]:checked").val(),fromDate:this.getPicker("#txtFromDate"),toDate:this.getPicker("#txtToDate"),selStatus:$("input[name=selStatus]:checked").val(),selCategories:$(".chooseCategory").chosen().val()||[],isSelectedCategory:function(e){var t=!1;return $.each(this.selCategories,function(){if(e===this||"Alle"===this)return t=!0,!1}),t},selNumber:"max"===$("input[name=selNumber]:checked").val(),cntNumber:0,maxNumber:$("#txtNumberMax").val(),fromNumber:$("#txtNumberFrom").val(),urlChange:$("#chkUrlChange").prop("checked"),newBlogUrl:$("#txtNewBlogUrl").val(),staticImgUrl:"<% staticURL %><% site.alias %>/images/",staticFileUrl:"<% staticURL %><% site.alias %>/files/",wpMediaUrl:"",siteStoriesHref:"<% site.url action="stories" %>".substr("<% site.url %>".indexOf("//")+2),sliceFrom:function(){return parseInt(this.fromNumber,10)-1},sliceTo:function(){return parseInt(this.maxNumber,10)+this.sliceFrom()},properDates:function(){return!this.selDate||this.fromDate>0&&this.toDate>0},validDates:function(){return!this.selDate||this.fromDate<this.toDate},validCategoryNum:function(){return this.selCategories.length>0},validCategoryMix:function(){return!($.inArray("Alle",this.selCategories)>=0&&this.selCategories.length>1)},validMaxNumber:function(){return!this.selNumber||!isNaN(parseInt(this.maxNumber,10))},validFromNumber:function(){return!this.selNumber||!isNaN(parseInt(this.fromNumber,10))},validBlogUrl:function(){return!this.urlChange||this.newBlogUrl.indexOf("localhost")||/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/.test(this.newBlogUrl)}};if(s.regStaticImg=new RegExp(s.staticImgUrl.replace("https:","https?:").replace(/\//gi,"\\/"),"gi"),s.regStaticFile=new RegExp(s.staticFileUrl.replace("https:","https?:").replace(/\//gi,"\\/"),"gi"),!this.validateSelectionParams(s))return!1;if(s.timeouts.length>0){var r=s.timeouts.split("/");$.each(r,function(t,s){switch(t){case 0:e.timeoutStories=parseInt(s,10);break;case 1:e.timeoutBody=parseInt(s,10);break;case 2:e.timeoutComments=parseInt(s,10)}})}s.urlChange&&("/"!==s.newBlogUrl.substr(s.newBlogUrl.length-1)&&(s.newBlogUrl+="/"),s.wpMediaUrl=s.newBlogUrl),this.params=s,$("#btnIntro, .btnContainer .actionButton").off("click"),this.musStatusScreen.blog=this.musSelectionScreen.blog,this.renderScreen("musStatusScreen"),this.musStory=$("#musStory").text(),this.musPartials.musComment=$("#musComment").text(),this.filelen=0,this.stories.length=0,this.blobList.length=0,this.resourceList.length=0,Object.keys(this.xrefs).forEach(function(t){delete e.xrefs[t]}),this.commentSelectors.initSet(),this.params.debugMode&&(console.log("--------------- Start of blog export process ---------------"),console.log("timeoutStories:",e.timeoutStories,"timeoutBody:",e.timeoutBody,"timeoutComments:",e.timeoutComments),console.log("--------------- Parameter ---------------"),console.log(JSON.stringify(this.params)),console.log("--------------- URL progress ---------------")),this.recursiveStories(0,this.stories)},addExportMenuButton:function(){var e,t;$.each([{test:".message>a",appendTo:"parent"},{test:".modToolbarLeft",appendTo:"self"},{test:"#wrapper",appendTo:"self"},{test:"body",appendTo:"self"}],function(){if((e=$(this.test)).length>0){switch(t="self"===this.appendTo?e.eq(0):e.eq(0).parent(),this.test.substr(0,3)){case".me":t.append('<button id="msgButton" class="startExport actionButton">Blog exportieren...</button>');break;case".mo":t.append('<span style="display:inline-block;margin-left:30px">&dArr;<a href="#" id="modToolbar-export" class="startExport" style="margin-left:6px">Blog exportieren</a></span>');break;default:t.append('<button id="btnExport" class="startExport actionButton">&or;</button>')}return!1}})},showSelectionScreen:function(){yepnope([{test:e.isFontAwesomePresent(),nope:"https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"},{test:"videoload"in window,nope:"https://static.twoday.net/cdn/files/videoload2-export-min-js.js"},{test:"undefined"==typeof Autolinker,yep:"https://cdnjs.cloudflare.com/ajax/libs/autolinker/1.6.2/Autolinker.min.js",complete:function(){e.autoLinker=new Autolinker({stripPrefix:!1,className:"autolinker"})}},{test:void 0===$.fn.chosen,yep:["https://cdnjs.cloudflare.com/ajax/libs/chosen/1.1.0/chosen.min.css","https://cdnjs.cloudflare.com/ajax/libs/chosen/1.1.0/chosen.jquery.min.js"],complete:function(){var t=$.get("/topics",function(t){e.musSelectionScreen.categories.length=0,$(t).find(".listItem td>a").each(function(){e.musSelectionScreen.categories.push($(this).text())}),e.renderScreen("musSelectionScreen"),$(".chooseCategory").chosen({width:"100%"}),yepnope({test:void 0===$.fn.pickadate,yep:["https://cdnjs.cloudflare.com/ajax/libs/pickadate.js/3.5.6/compressed/themes/classic.css","https://cdnjs.cloudflare.com/ajax/libs/pickadate.js/3.5.6/compressed/themes/classic.date.css","https://cdnjs.cloudflare.com/ajax/libs/pickadate.js/3.5.6/compressed/picker.js","https://cdnjs.cloudflare.com/ajax/libs/pickadate.js/3.5.6/compressed/picker.date.js"],complete:function(){$(".datepicker").pickadate({monthsFull:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthsShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],weekdaysFull:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],weekdaysShort:["So","Mo","Di","Mi","Do","Fr","Sa"],today:"Heute",clear:"Löschen",close:"Schließen",firstDay:1,format:"dd.mm.yyyy",formatSubmit:"yyyy/mm/dd",labelMonthNext:"Nächster Monat",labelMonthPrev:"Vorheriger Monat",labelMonthSelect:"Bitte Monat auswählen",labelYearSelect:"Bitte Jahr auswählen",selectMonths:!0,selectYears:!0})}}),$("#btnVersion").on("click",function(){$.getJSON("https://rawgit.com/NeonWilderness/twodayExport/master/dist/version.json",function(t){var s,r,n,i=!1;$.each(t.packages,function(){if("twodayExport"===this.name)return i=parseFloat(this.version)>parseFloat(e.musSelectionScreen.version),s=this,!1}),i?(r="bgYellow",n=Mustache.render('<i class="fa fa-info-circle"></i>Es existiert eine neuere Version {{version}} vom {{released}}! Bitte <a target="_blank" href="{{url}}">laden</a> Sie die gepackte Layout-Datei herunter, löschen dann das bisherige Layout "twodayExport" und importieren danach die neue Version!',s)):(r="bgGreen",n='<i class="fa fa-check"></i>Es gibt keine neuere Exportversion!'),$("#selMessage").html(n).addClass(r).show(0)}).fail(function(){$("#selMessage").html('<i class="fa fa-medkit"></i>Versionsinfos konnten nicht geladen werden.').addClass("bgRed").show(0)})}),$(".btnContainer .actionButton").on("click",function(t){switch(t.preventDefault(),t.target.id){case"btnCancel":e.closeOverlay();break;default:e.exportArticlesAndComments("btnInfosOnly"===t.target.id)}}),$(document).on("keyup",function(t){27===t.which&&e.closeOverlay()}),$("#selOverlay").show(200)}).fail(function(){alert("Fehler beim Lesen der Themenseite: \topics, status: "+t.status+", text: "+t.statusText)})}}])},enableExportFeature:function(){this.addExportMenuButton(),$("body").append($("#mainExport").html()),$(".startExport").on("click",function(t){t.preventDefault(),e.showSelectionScreen()})}};function t(){yepnope([{test:"undefined"==typeof jQuery,yep:["https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"],complete:function(){yepnope([{test:"undefined"==typeof Mustache,yep:["https://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.8.1/mustache.min.js"],complete:function(){e.enableExportFeature()}}])}}])}if(!e.isUserAdministrator())return!1;if("undefined"==typeof yepnope){var s=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src="https://cdnjs.cloudflare.com/ajax/libs/yepnope/1.5.4/yepnope.min.js",r.onload=t,s.appendChild(r)}else t()}()</script>